<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyreign Hub | V48.0 Complete Restoration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <style>
        /* CORE CSS */
        :root { --primary: #6366f1; --accent: #f472b6; }
        body {
            font-family: 'Space Grotesk', 'Noto Sans SC', sans-serif;
            background: linear-gradient(-45deg, #020617, #1e1b4b, #be185d, #0f766e);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            color: #fff; min-height: 100vh; overflow-x: hidden; cursor: none;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #cursor { position: fixed; width: 20px; height: 20px; background: white; border-radius: 50%; pointer-events: none; z-index: 9999; mix-blend-mode: difference; transition: transform 0.1s; }
        
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); transition: transform 0.3s; }
        .glass-card:hover { transform: translateY(-5px); }
        
        /* NAV BAR M·ªû R·ªòNG */
        nav { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; gap: 6px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); flex-wrap: wrap; justify-content: center; width: 95%; max-width: 800px; }
        .nav-btn { padding: 8px 14px; border-radius: 18px; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; color: #94a3b8; white-space: nowrap; }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); }
        
        .tab-content { display: none; opacity: 0; animation: fadeIn 0.5s forwards; padding-bottom: 120px; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* UTILS */
        .glow-green { box-shadow: 0 0 40px #22c55e !important; border-color: #22c55e !important; }
        .glow-red { box-shadow: 0 0 40px #ef4444 !important; border-color: #ef4444 !important; }
        .mic-ripple { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); opacity: 0; animation: ripple 1.5s infinite; }
        @keyframes ripple { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(2); opacity: 0; } }
        #progress-bar { width: 0%; height: 4px; background: #22c55e; transition: width 0.1s linear; position: absolute; bottom: 0; left: 0; }
        .reading-text { line-height: 1.8; letter-spacing: 1px; text-align: justify; }
        textarea:focus { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
        .coin-pop-green { animation: coinPop 0.3s ease; color: #4ade80 !important; }
        .coin-pop-red { animation: coinPop 0.3s ease; color: #f87171 !important; }
        @keyframes coinPop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
        
        /* MODALS */
        .full-modal { transition: opacity 0.3s ease; }
        .full-modal.hidden { display: none; }
        .npc-bubble { position: absolute; background: white; color: black; padding: 12px; border-radius: 20px; border-bottom-left-radius: 0; box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); font-weight: 800; font-size: 10px; max-width: 200px; border: 2px solid #6366f1; z-index: 50; }
        .inv-slot { width: 50px; height: 50px; background: rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer; }
        .inv-slot:hover { border-color: #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .song-item { display: flex; gap: 12px; padding: 10px; border-radius: 12px; background: rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; align-items: center; }
        .song-item:hover { background: rgba(255,255,255,0.15); }
        .song-item img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }

        /* GAME WORLD CSS (FIX N·ªÄN ƒêEN CHE PH·ª¶) */
        #game-container { position: fixed; inset: 0; z-index: 5000; background: #000000; display: none; pointer-events: auto; }
        #game-ui { position: absolute; top: 20px; left: 20px; color: white; z-index: 5001; pointer-events: none; }
        .key-hint { background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 5px; font-size: 10px; font-weight: bold; margin-right: 5px; }

        /* AI TEST CSS */
        .grammar-box { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        .step-indicator { display: flex; gap: 5px; justify-content: center; margin-bottom: 20px; }
        .step-dot { width: 10px; height: 10px; border-radius: 50%; background: #333; }
        .step-dot.active { background: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .chat-bubble { background: white; color: black; padding: 10px 20px; border-radius: 20px; margin-bottom: 10px; display: inline-block; max-width: 80%; font-weight: bold; }
        .fill-blank { border-bottom: 2px solid var(--primary); display: inline-block; min-width: 50px; text-align: center; color: var(--accent); }
    </style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="cursor"></div>
<audio id="sfx-coin" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
<audio id="sfx-click" src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-click-900.mp3"></audio>
<audio id="sfx-type" src="https://assets.mixkit.co/sfx/preview/mixkit-keyboard-typing-1386.mp3"></audio>

<div class="fixed top-6 right-6 z-[2000] flex items-center gap-3 bg-black/40 backdrop-blur-xl px-5 py-2 rounded-full border border-yellow-500/30 shadow-2xl transition hover:scale-105">
    <div class="w-10 h-10">
        <model-viewer src="./coin.glb" alt="Coin" auto-rotate rotation-per-second="30deg" disable-zoom style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
    </div>
    <div class="flex flex-col items-end">
        <span class="text-[9px] font-bold text-yellow-500/80 uppercase tracking-widest">Balance</span>
        <span id="coin-display" class="text-2xl font-black text-yellow-400 leading-none tabular-nums">0</span>
    </div>
</div>

<div class="fixed top-32 right-6 z-[2000] cursor-pointer transition hover:scale-110 active:scale-95 group flex flex-col items-center" onclick="enterGameWorld()">
    <div class="w-16 h-16 bg-indigo-900/80 rounded-full border-2 border-indigo-400 flex items-center justify-center shadow-lg shadow-indigo-500/50">
        <span class="text-3xl">üè∞</span>
    </div>
    <div class="bg-indigo-600 text-white px-2 py-1 rounded text-[8px] font-bold uppercase mt-1">V√†o Th·∫ø Gi·ªõi</div>
</div>

<div id="game-container">
    <div id="game-ui">
        <h2 class="text-xl font-black uppercase italic text-yellow-400">Th·∫ø Gi·ªõi Skyreign</h2>
        <div class="mt-2 text-xs text-gray-300">
            <p class="mb-1"><span class="key-hint">W A S D</span> Di chuy·ªÉn</p>
            <p><span class="key-hint">SHIFT + W</span> Ch·∫°y nhanh</p>
        </div>
    </div>
    <button onclick="exitGameWorld()" class="absolute top-6 right-6 z-[5002] text-white hover:text-red-500 font-black text-xl bg-white/10 w-12 h-12 rounded-full flex items-center justify-center border border-white/20">‚úï</button>
</div>

<div class="fixed bottom-24 left-6 z-[2000] cursor-pointer transition hover:scale-110 active:scale-95 group" onclick="openInventory()">
    <div class="w-24 h-24 relative">
        <model-viewer src="./loot.glb" alt="Inventory" auto-rotate rotation-per-second="20deg" disable-zoom style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
        <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-3 py-1 rounded-full font-black text-[8px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition whitespace-nowrap shadow-lg border border-white/20">T√∫i ƒê·ªì</div>
    </div>
</div>

<div id="shop-modal" class="full-modal hidden fixed inset-0 z-[3000] bg-black/95 flex items-center justify-center p-4">
    <div class="relative w-full max-w-6xl aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl border border-white/10">
        <button onclick="closeShop()" class="absolute top-6 right-6 z-50 text-white hover:text-red-500 font-black text-xl bg-white/10 w-12 h-12 rounded-full flex items-center justify-center border border-white/20 transition hover:rotate-90">‚úï</button>
        <div class="absolute bottom-10 left-10 w-48 h-80 md:w-64 md:h-96 z-20">
            <model-viewer src="./main.glb" alt="Shopkeeper" environment-image="neutral" camera-controls disable-zoom shadow-intensity="2" exposure="1.5" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
            <div class="npc-bubble -top-10 left-20"><p id="npc-text">...</p></div>
        </div>
        <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
            <div class="relative w-72 h-72 md:w-[500px] md:h-[500px] pointer-events-auto group flex flex-col items-center">
                <button onclick="buyItem()" class="absolute -top-16 z-50 bg-yellow-500 hover:bg-yellow-400 text-black px-6 py-3 rounded-full font-black uppercase tracking-widest shadow-lg shadow-yellow-500/50 animate-bounce transition transform hover:scale-110 border-4 border-black">MUA NGAY (100 ü™ô)</button>
                <model-viewer id="shop-mob-viewer" src="./mob1.glb" alt="Mob" environment-image="neutral" auto-rotate camera-controls shadow-intensity="2" exposure="1.5" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
                <div class="absolute top-20 -right-10 md:-right-20 bg-black/80 backdrop-blur-xl border border-red-500/50 p-6 rounded-2xl w-56 shadow-2xl opacity-0 group-hover:opacity-100 transition duration-300 translate-x-4 group-hover:translate-x-0">
                    <h3 class="text-red-500 font-black text-3xl mb-2 uppercase italic tracking-tighter" id="mob-name">RAICER</h3>
                    <div class="space-y-3 text-xs font-bold text-gray-400">
                        <div class="flex justify-between border-b border-white/10 pb-1"><span>‚öî T·∫•n C√¥ng:</span> <span class="text-white" id="mob-atk">200</span></div>
                        <div class="flex justify-between border-b border-white/10 pb-1"><span>‚ô• M√°u:</span> <span class="text-white" id="mob-hp">900</span></div>
                        <div class="mt-2 text-[10px] italic text-gray-500 text-center">Qu√°i v·∫≠t c·∫•p 1</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-30 flex gap-4">
            <button onclick="navShop(-1)" class="px-6 py-3 bg-white/5 hover:bg-white/20 border border-white/20 rounded-xl font-bold text-xs uppercase tracking-widest text-gray-300 hover:text-white transition flex items-center gap-2">‚óÄ L√πi l·∫°i</button>
            <button onclick="navShop(1)" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 shadow-lg shadow-indigo-500/50 rounded-xl font-bold text-xs uppercase tracking-widest text-white transition flex items-center gap-2">Ti·∫øp theo ‚ñ∂</button>
        </div>
    </div>
</div>

<div id="inv-modal" class="full-modal hidden fixed inset-0 z-[3000] bg-black/90 flex items-center justify-center p-4">
    <div class="relative w-full max-w-5xl aspect-video bg-[#1a1a1a] rounded-3xl overflow-hidden shadow-2xl border border-white/10">
        <img src="./iv.jpg" alt="Inventory BG" class="absolute inset-0 w-full h-full object-cover opacity-60">
        <button onclick="closeInventory()" class="absolute top-6 right-6 z-50 text-white hover:text-red-500 font-black text-xl bg-black/60 w-12 h-12 rounded-full flex items-center justify-center border border-white/20">‚úï</button>
        <div class="absolute inset-0 flex flex-col p-10 z-10">
            <div class="flex-1 flex justify-between items-center px-10">
                <div class="flex flex-col gap-4">
                    <div class="inv-slot"><span class="text-[8px] text-white/30">HEAD</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">BODY</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">LEGS</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">HAND</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">ACC</span></div>
                </div>
                <div class="relative w-96 h-96 flex items-center justify-center">
                    <div id="inv-mob-container" class="w-full h-full"></div>
                    <div id="inv-stats" class="hidden absolute top-10 -right-10 bg-black/70 backdrop-blur border border-indigo-500/50 p-4 rounded-xl w-40">
                        <h4 class="text-indigo-400 font-bold text-xs uppercase mb-2 border-b border-white/10 pb-1">Ch·ªâ S·ªë T·ªïng</h4>
                        <div class="space-y-1 text-[10px] text-gray-300">
                            <div class="flex justify-between"><span>ATK:</span> <span class="text-white">200</span></div>
                            <div class="flex justify-between"><span>HP:</span> <span class="text-white">900</span></div>
                            <div class="flex justify-between"><span>DEF:</span> <span class="text-white">50</span></div>
                            <div class="flex justify-between"><span>SPD:</span> <span class="text-white">120</span></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col gap-4">
                    <div class="inv-slot"><span class="text-[8px] text-white/30">WEAPON</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">SHIELD</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">RING 1</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">RING 2</span></div>
                    <div class="inv-slot"><span class="text-[8px] text-white/30">PET</span></div>
                </div>
            </div>
            <div class="h-32 mt-4 bg-black/40 rounded-xl border border-white/10 p-4">
                <h4 class="text-[10px] font-bold text-gray-400 uppercase mb-2 tracking-widest">T√∫i ƒê·ªì (Inventory)</h4>
                <div class="flex gap-2 overflow-x-auto pb-2">
                    <div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div><div class="inv-slot min-w-[50px]"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<nav>
    <button onclick="switchTab('home')" class="nav-btn active" id="n-home">S·∫£nh</button>
    <button onclick="switchTab('vocab')" class="nav-btn" id="n-vocab">H·ªçc T·ª´</button>
    <button onclick="switchTab('reading')" class="nav-btn" id="n-reading">ƒê·ªçc Hi·ªÉu</button>
    <button onclick="switchTab('speaking')" class="nav-btn" id="n-speaking">Luy·ªán N√≥i</button>
    <button onclick="switchTab('grammar')" class="nav-btn" id="n-grammar">Ng·ªØ Ph√°p</button>
    <button onclick="switchTab('music')" class="nav-btn" id="n-music">Nh·∫°c</button>
    <button onclick="switchTab('study')" class="nav-btn bg-pink-600/50 hover:bg-pink-500" id="n-study">Ghi Nh·ªõ</button>
    <button onclick="switchTab('test')" class="nav-btn bg-red-600/50 hover:bg-red-500" id="n-test">Ki·ªÉm Tra</button>
</nav>

<div id="home" class="tab-content active">
    <div class="h-screen flex flex-col items-center justify-center relative">
        <div class="glass-card p-12 text-center max-w-md mx-4 z-10">
            <h1 class="text-6xl md:text-8xl font-black italic tracking-tighter mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-pink-400">SKYREIGN</h1>
            <p class="text-xs tracking-[0.5em] text-gray-400 uppercase mb-10">L∆∞u Thi·∫øt Hoa ‚Ä¢ V48.0 Complete</p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="switchTab('study')" class="py-4 bg-pink-600 hover:bg-pink-500 rounded-xl font-bold text-xs uppercase tracking-widest transition">H·ªçc Ng·ªØ Ph√°p</button>
                <button onclick="switchTab('test')" class="py-4 bg-red-600 hover:bg-red-500 rounded-xl font-bold text-xs uppercase tracking-widest transition shadow-lg">Ki·ªÉm Tra Ngay</button>
            </div>
        </div>
    </div>
</div>

<div id="study" class="tab-content">
    <div class="min-h-screen pt-24 px-4 pb-24 max-w-4xl mx-auto">
        <h2 class="text-3xl font-black text-center mb-8 text-pink-400 uppercase tracking-widest">Danh S√°ch Ng·ªØ Ph√°p</h2>
        <div id="grammar-list-container" class="space-y-4"></div>
    </div>
</div>

<div id="test" class="tab-content">
    <div class="min-h-screen pt-24 px-4 pb-24 max-w-4xl mx-auto flex flex-col items-center">
        <div id="test-menu" class="grid grid-cols-2 gap-4 w-full max-w-lg mb-8">
            <button onclick="startGrammarTest()" class="p-6 bg-indigo-600 rounded-2xl font-black uppercase hover:scale-105 transition shadow-lg text-sm">üß† Test Ng·ªØ Ph√°p (AI)</button>
            <button onclick="startFillBlankTest()" class="p-6 bg-green-600 rounded-2xl font-black uppercase hover:scale-105 transition shadow-lg text-sm">üìù ƒêi·ªÅn T·ª´ H·ªôi Tho·∫°i</button>
        </div>

        <div id="grammar-test-ui" class="glass-card p-8 w-full max-w-2xl hidden relative">
            <button onclick="closeTestUI()" class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>
            <div class="step-indicator">
                <div id="s1" class="step-dot active"></div><div id="s2" class="step-dot"></div><div id="s3" class="step-dot"></div><div id="s4" class="step-dot"></div>
            </div>
            <div class="text-center">
                <p id="gt-question" class="text-3xl font-bold mb-6 text-white tracking-wide"></p>
                <p id="gt-prompt" class="text-xs text-gray-400 uppercase tracking-widest mb-4">C√¢u h·ªèi c·ªßa AI:</p>
                <div id="gt-input-area">
                    <input type="text" id="gt-input" class="w-full bg-white/10 border border-white/20 rounded-xl p-4 text-center text-xl mb-4 outline-none focus:border-pink-500 transition" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi...">
                    <div id="gt-options" class="grid grid-cols-1 gap-2 mb-4 hidden"></div>
                    <button onclick="checkGrammarStep()" class="w-full py-4 bg-white text-black font-black uppercase rounded-xl hover:bg-indigo-400 transition">Ki·ªÉm Tra</button>
                </div>
                <p id="gt-feedback" class="mt-4 text-sm font-bold h-6"></p>
            </div>
        </div>

        <div id="fill-test-ui" class="glass-card p-8 w-full max-w-2xl hidden relative">
            <button onclick="closeTestUI()" class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>
            <div class="space-y-6">
                <div id="ft-dialogue" class="text-lg leading-relaxed text-gray-300">Loading...</div>
                <div id="ft-options" class="flex flex-wrap gap-2 justify-center pt-4 border-t border-white/10"></div>
                <p id="ft-feedback" class="text-center text-sm font-bold uppercase tracking-widest h-6"></p>
            </div>
        </div>
    </div>
</div>

<div id="reading" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-8 w-full max-w-3xl mx-4 relative" id="reading-card"> <div class="flex justify-between items-center mb-6"> <div class="text-[10px] font-black bg-pink-500 px-3 py-1 rounded-full uppercase tracking-widest">ƒêo·∫°n VƒÉn Ng·∫´u Nhi√™n</div> <div class="flex gap-2"> <button id="r-toggle-btn" onclick="toggleReadingRef()" class="text-[10px] font-bold text-green-400 hover:text-white uppercase tracking-widest transition border border-green-500 px-2 py-1 rounded-lg">Xem ƒê√°p √Ån (Vi·ªát)</button> <button onclick="nextParagraph()" class="text-[10px] font-bold text-gray-400 hover:text-white uppercase tracking-widest transition">ƒê·ªïi b√†i kh√°c ‚Üª</button> </div> </div> <div class="bg-black/20 p-6 rounded-2xl mb-6 border border-white/10 h-64 overflow-y-auto"> <p id="r-text" class="text-xl md:text-2xl font-medium text-gray-100 reading-text">Loading...</p> </div> <p class="text-xs text-gray-400 mb-2 italic">H√£y d·ªãch ƒëo·∫°n vƒÉn tr√™n sang Ti·∫øng Vi·ªát (+1 Coin n·∫øu ƒë√∫ng):</p> <textarea id="r-input" rows="4" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white placeholder-gray-600 outline-none focus:border-indigo-500 transition mb-6" placeholder="G√µ b·∫£n d·ªãch c·ªßa b·∫°n v√†o ƒë√¢y..."></textarea> <button onclick="checkReading()" class="w-full py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] hover:bg-indigo-400 hover:text-white transition mb-4 shadow-lg">Ki·ªÉm Tra B·∫£n D·ªãch</button> <div id="r-feedback" class="text-center min-h-[40px]"> <p id="r-msg" class="text-[11px] font-bold uppercase tracking-widest mb-1"></p> </div> </div> </div> </div>

<div id="vocab" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-lg mx-4 relative" id="vocab-card"> <div class="flex justify-between items-center mb-8"> <button onclick="changeVocabMode()" id="v-mode-btn" class="text-[10px] font-black bg-pink-500 px-3 py-1 rounded-full uppercase tracking-widest hover:scale-105 transition">Mode: H√°n ‚ûî Vi·ªát</button> <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">HSK 1 FULL</div> </div> <div id="v-question" class="text-7xl font-black text-center mb-8 tracking-tighter min-h-[100px] flex items-center justify-center">?</div> <input type="text" id="v-input" placeholder="Nh·∫≠p ƒë√°p √°n..." class="w-full bg-transparent border-b-2 border-white/20 py-3 text-center font-bold text-2xl outline-none focus:border-indigo-500 transition text-white placeholder-gray-600 mb-8" autocomplete="off"> <button onclick="checkVocab()" class="w-full py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] hover:bg-gray-200 transition mb-4">Ki·ªÉm Tra</button> <div id="v-feedback" class="text-center h-10"> <p id="v-msg" class="text-[11px] font-bold uppercase tracking-widest"></p> <p id="v-hint" class="text-[12px] font-bold text-red-400 mt-1 uppercase hidden"></p> </div> </div> </div> </div>

<div id="speaking" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-md mx-4 text-center relative overflow-hidden" id="speak-card"> <div class="text-[10px] uppercase tracking-widest text-indigo-400 font-black mb-8">V18.0 - Fast Catch</div> <div class="mb-8 relative group"> <div id="s-hz" class="text-9xl font-black mb-2 tracking-tighter cursor-pointer transition hover:text-indigo-400" onclick="speakText(document.getElementById('s-hz').innerText)">Êàë</div> <div id="s-py" class="text-2xl text-gray-500 mb-1">w«í</div> <div id="s-mn" class="text-xs font-bold bg-white/10 px-3 py-1 rounded-full inline-block">T√îI</div> </div> <div class="flex justify-center items-center gap-6 mb-8"> <button onclick="changeSpeakWord(-1)" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition">‚Üê</button> <div class="relative"> <div id="mic-ring" class="hidden mic-ripple"></div> <button id="mic-btn" class="w-20 h-20 bg-indigo-600 rounded-full flex items-center justify-center shadow-2xl relative z-10 transition hover:scale-110 active:scale-90 text-white"> <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg> </button> </div> <button onclick="changeSpeakWord(1)" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition">‚Üí</button> </div> <div id="s-feedback" class="text-[11px] font-bold uppercase tracking-widest text-gray-400 h-16 flex flex-col items-center justify-center px-4"> <span id="s-status">B·∫•m mic v√† n√≥i ngay</span> <span id="s-sub" class="text-[9px] text-gray-500 mt-1"></span> </div> <div id="s-live-text" class="absolute bottom-1 w-full text-center text-[9px] text-indigo-300/50 uppercase tracking-widest"></div> <div id="progress-bar"></div> </div> </div> </div>
<div id="grammar" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-2xl mx-4 relative overflow-hidden" id="grammar-card"> <div class="flex justify-between items-center mb-10"> <button onclick="toggleGrammarMode()" id="g-mode-badge" class="text-[10px] font-black bg-indigo-600 px-3 py-1 rounded-full uppercase tracking-widest hover:scale-110 transition shadow-lg shadow-indigo-500/50">Trung ‚ûî Vi·ªát</button> <div class="text-[9px] font-bold text-gray-400">HSK1 GRAMMAR</div> </div> <div class="text-center mb-10 min-h-[120px] flex flex-col justify-center items-center"> <div id="g-question" class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight drop-shadow-lg cursor-pointer hover:text-indigo-300 transition" onclick="readGrammarQuestion()">...</div> <p id="g-instruction" class="text-gray-500 text-sm italic">H√£y d·ªãch c√¢u tr√™n</p> </div> <input type="text" id="g-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." class="w-full bg-transparent border-b-2 border-white/10 py-4 text-center text-xl font-medium outline-none focus:border-indigo-500 transition mb-6" text-white placeholder-gray-600" autocomplete="off"> <div class="grid grid-cols-4 gap-4 mb-6"> <button onclick="nextGrammar()" class="col-span-1 py-4 bg-white/5 hover:bg-white/10 rounded-2xl font-bold text-[10px] uppercase tracking-widest text-gray-400 hover:text-white transition">B·ªè qua</button> <button onclick="checkGrammar()" class="col-span-3 py-4 bg-white text-black hover:bg-indigo-400 hover:text-white rounded-2xl font-black text-xs uppercase tracking-[0.2em] transition shadow-lg">Ki·ªÉm tra</button> </div> <div id="g-feedback" class="text-center h-20"> <div id="g-msg" class="text-[11px] font-bold uppercase tracking-widest mb-1"></div> <div id="g-note" class="text-[12px] font-bold text-red-400 mt-2 uppercase"></div> </div> </div> </div> </div>

<div id="music" class="tab-content"> <div class="min-h-screen flex flex-col items-center justify-center pt-20 pb-20"> <div class="flex flex-col md:flex-row items-center justify-center gap-8 w-full max-w-6xl px-4"> <div class="glass-card p-6 w-full md:w-72 h-80 overflow-y-auto"> <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-indigo-400 border-b border-white/10 pb-2">V-Pop Hits</h3> <div id="v-list" class="space-y-2"></div> </div> <div class="w-full max-w-md flex flex-col items-center"> <h4 class="text-4xl font-black text-white tracking-tighter uppercase mb-4 drop-shadow-lg">Music Pod</h4> <div class="relative w-full h-[250px]"> <model-viewer src="./airpods.glb" alt="My Airpods" auto-rotate camera-controls shadow-intensity="1" exposure="0.8" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer> </div> <div class="w-full aspect-video bg-black rounded-2xl overflow-hidden border-2 border-white/20 shadow-2xl mt-[-20px] relative z-10"> <div id="player"></div> <video id="mp4-player" controls playsinline class="hidden w-full h-full object-cover"></video> </div> </div> <div class="glass-card p-6 w-full md:w-72 h-80 overflow-y-auto"> <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-pink-400 border-b border-white/10 pb-2">Chinese Hits</h3> <div id="c-list" class="space-y-2"></div> </div> </div> </div> </div>

<script>
    // --- CORE VARIABLES ---
    let userCoins = parseInt(localStorage.getItem('skyCoins')) || 0;
    let myMobs = JSON.parse(localStorage.getItem('skyMobs')) || [];
    const coinDisplay = document.getElementById('coin-display');
    const coinSfx = document.getElementById('sfx-coin');
    const clickSfx = document.getElementById('sfx-click');
    if(coinDisplay) coinDisplay.innerText = userCoins;

    function updateCoins(amount) {
        userCoins += amount;
        localStorage.setItem('skyCoins', userCoins);
        if(coinDisplay) {
            coinDisplay.innerText = userCoins;
            coinDisplay.classList.remove('coin-pop-green', 'coin-pop-red');
            void coinDisplay.offsetWidth;
            if(amount > 0) { coinDisplay.classList.add('coin-pop-green'); coinSfx.currentTime = 0; coinSfx.play().catch(e=>{}); } 
            else { coinDisplay.classList.add('coin-pop-red'); }
        }
    }

    // --- FULL DATA SET (ƒê√É KH√îI PH·ª§C) ---
    const vocabData = [
        { hz: "Êàë", py: "w«í", mn: "t√¥i" }, { hz: "‰Ω†", py: "n«ê", mn: "b·∫°n" }, { hz: "‰ªñ", py: "tƒÅ", mn: "anh ·∫•y" }, { hz: "Â•π", py: "tƒÅ", mn: "c√¥ ·∫•y" }, { hz: "Êàë‰ª¨", py: "w«ímen", mn: "ch√∫ng t√¥i" }, { hz: "Ë∞Å", py: "sh√©i", mn: "ai" },
        { hz: "Áà∏Áà∏", py: "b√†ba", mn: "b·ªë" }, { hz: "Â¶àÂ¶à", py: "mƒÅma", mn: "m·∫π" }, { hz: "ÂÑøÂ≠ê", py: "√©rzi", mn: "con trai" }, { hz: "Â•≥ÂÑø", py: "n«ö√©r", mn: "con g√°i" }, { hz: "ËÄÅÂ∏à", py: "l«éoshƒ´", mn: "th·∫ßy c√¥" }, { hz: "Â≠¶Áîü", py: "xu√©sheng", mn: "h·ªçc sinh" }, { hz: "ÂêåÂ≠¶", py: "t√≥ngxu√©", mn: "b·∫°n h·ªçc" }, { hz: "ÊúãÂèã", py: "p√©ngyou", mn: "b·∫°n b√®" }, { hz: "‰∫∫", py: "r√©n", mn: "ng∆∞·ªùi" }, { hz: "ÂÖàÁîü", py: "xiƒÅnsheng", mn: "ng√†i/√¥ng" }, { hz: "Â∞èÂßê", py: "xi«éojiƒõ", mn: "c√¥/ch·ªã" },
        { hz: "Èõ∂", py: "l√≠ng", mn: "kh√¥ng" }, { hz: "‰∏Ä", py: "yƒ´", mn: "m·ªôt" }, { hz: "‰∫å", py: "√®r", mn: "hai" }, { hz: "‰∏â", py: "sƒÅn", mn: "ba" }, { hz: "Âõõ", py: "s√¨", mn: "b·ªën" }, { hz: "‰∫î", py: "w«î", mn: "nƒÉm" }, { hz: "ÂÖ≠", py: "li√π", mn: "s√°u" }, { hz: "‰∏É", py: "qƒ´", mn: "b·∫£y" }, { hz: "ÂÖ´", py: "bƒÅ", mn: "t√°m" }, { hz: "‰πù", py: "ji«î", mn: "ch√≠n" }, { hz: "ÂçÅ", py: "sh√≠", mn: "m∆∞·ªùi" },
        { hz: "Áé∞Âú®", py: "xi√†nz√†i", mn: "b√¢y gi·ªù" }, { hz: "ÁÇπ", py: "di«én", mn: "gi·ªù" }, { hz: "ÂàÜ", py: "fƒìn", mn: "ph√∫t" }, { hz: "‰ªäÂ§©", py: "jƒ´ntiƒÅn", mn: "h√¥m nay" }, { hz: "ÊòéÂ§©", py: "m√≠ngtiƒÅn", mn: "ng√†y mai" }, { hz: "Êò®Â§©", py: "zu√≥tiƒÅn", mn: "h√¥m qua" }, { hz: "Âπ¥", py: "ni√°n", mn: "nƒÉm" }, { hz: "Êúà", py: "yu√®", mn: "th√°ng" }, { hz: "Êó•", py: "r√¨", mn: "ng√†y" }, { hz: "Âè∑", py: "h√†o", mn: "ng√†y (s·ªë)" }, { hz: "ÊòüÊúü", py: "xƒ´ngqƒ´", mn: "tu·∫ßn/th·ª©" }, { hz: "‰∏äÂçà", py: "sh√†ngw«î", mn: "bu·ªïi s√°ng" }, { hz: "‰∏≠Âçà", py: "zh≈çngw«î", mn: "bu·ªïi tr∆∞a" }, { hz: "‰∏ãÂçà", py: "xi√†w«î", mn: "bu·ªïi chi·ªÅu" }, { hz: "Êó∂ÂÄô", py: "sh√≠hou", mn: "l√∫c/khi" },
        { hz: "ÊòØ", py: "sh√¨", mn: "l√†" }, { hz: "Êúâ", py: "y«íu", mn: "c√≥" }, { hz: "Âú®", py: "z√†i", mn: "·ªü/ƒëang" }, { hz: "Ë¶Å", py: "y√†o", mn: "mu·ªën/c·∫ßn" }, { hz: "ÂñúÊ¨¢", py: "x«êhuan", mn: "th√≠ch" }, { hz: "Áà±", py: "√†i", mn: "y√™u" }, { hz: "ÂêÉ", py: "chƒ´", mn: "ƒÉn" }, { hz: "Âñù", py: "hƒì", mn: "u·ªëng" }, { hz: "Âéª", py: "q√π", mn: "ƒëi" }, { hz: "Êù•", py: "l√°i", mn: "ƒë·∫øn" }, { hz: "ÊÉ≥", py: "xi«éng", mn: "mu·ªën/nghƒ©" }, { hz: "Áúã", py: "k√†n", mn: "xem/nh√¨n" }, { hz: "Âê¨", py: "tƒ´ng", mn: "nghe" }, { hz: "ËØ¥", py: "shu≈ç", mn: "n√≥i" }, { hz: "ËØª", py: "d√∫", mn: "ƒë·ªçc" }, { hz: "ÂÜô", py: "xiƒõ", mn: "vi·∫øt" }, { hz: "ÂÅö", py: "zu√≤", mn: "l√†m" }, { hz: "‰π∞", py: "m«éi", mn: "mua" }, { hz: "Áªô", py: "gƒõi", mn: "cho" }, { hz: "Âõû", py: "hu√≠", mn: "v·ªÅ" }, { hz: "‰Ωè", py: "zh√π", mn: "s·ªëng/·ªü" }, { hz: "ËÆ§ËØÜ", py: "r√®nshi", mn: "quen bi·∫øt" }, { hz: "‰ºö", py: "hu√¨", mn: "bi·∫øt (k·ªπ nƒÉng)" }, { hz: "ËÉΩ", py: "n√©ng", mn: "c√≥ th·ªÉ" },
        { hz: "Â•Ω", py: "h«éo", mn: "t·ªët" }, { hz: "Â§ö", py: "du≈ç", mn: "nhi·ªÅu" }, { hz: "Â∞ë", py: "sh«éo", mn: "√≠t" }, { hz: "Â§ß", py: "d√†", mn: "to/l·ªõn" }, { hz: "Â∞è", py: "xi«éo", mn: "nh·ªè/b√©" }, { hz: "ÂÜ∑", py: "lƒõng", mn: "l·∫°nh" }, { hz: "ÁÉ≠", py: "r√®", mn: "n√≥ng" }, { hz: "È´òÂÖ¥", py: "gƒÅox√¨ng", mn: "vui v·∫ª" }, { hz: "ÊºÇ‰∫Æ", py: "pi√†oliang", mn: "xinh ƒë·∫πp" }, { hz: "ÂØπ", py: "du√¨", mn: "ƒë√∫ng" }, { hz: "Èîô", py: "cu√≤", mn: "sai" }, { hz: "Âøô", py: "m√°ng", mn: "b·∫≠n" }, { hz: "Á¥Ø", py: "l√®i", mn: "m·ªát" },
        { hz: "Ê∞¥", py: "shu«ê", mn: "n∆∞·ªõc" }, { hz: "È•≠", py: "f√†n", mn: "c∆°m" }, { hz: "Ëèú", py: "c√†i", mn: "m√≥n ƒÉn/rau" }, { hz: "Ëå∂", py: "ch√°", mn: "tr√†" }, { hz: "ËãπÊûú", py: "p√≠nggu«í", mn: "t√°o" }, { hz: "Èí±", py: "qi√°n", mn: "ti·ªÅn" }, { hz: "‰∏úË•ø", py: "d≈çngxi", mn: "ƒë·ªì ƒë·∫°c" }, { hz: "ÊùØÂ≠ê", py: "bƒìizi", mn: "c·ªëc/ly" }, { hz: "Ë°£Êúç", py: "yƒ´fu", mn: "qu·∫ßn √°o" }, { hz: "‰π¶", py: "sh≈´", mn: "s√°ch" }, { hz: "Ê°åÂ≠ê", py: "zhu≈çzi", mn: "b√†n" }, { hz: "Ê§ÖÂ≠ê", py: "y«êzi", mn: "gh·∫ø" }, { hz: "ÁîµËÑë", py: "di√†nn«éo", mn: "m√°y t√≠nh" }, { hz: "ÁîµËßÜ", py: "di√†nsh√¨", mn: "tivi" }, { hz: "ÂÆ∂", py: "jiƒÅ", mn: "nh√†" }, { hz: "Â≠¶Ê†°", py: "xu√©xi√†o", mn: "tr∆∞·ªùng h·ªçc" }, { hz: "È•≠Â∫ó", py: "f√†ndi√†n", mn: "nh√† h√†ng" }, { hz: "ÂïÜÂ∫ó", py: "shƒÅngdi√†n", mn: "c·ª≠a h√†ng" }, { hz: "Âåó‰∫¨", py: "bƒõijƒ´ng", mn: "B·∫Øc Kinh" }, { hz: "‰∏≠ÂõΩ", py: "zh≈çnggu√≥", mn: "Trung Qu·ªëc" },
        { hz: "‰∏ç", py: "b√π", mn: "kh√¥ng (ph·ªß ƒë·ªãnh)" }, { hz: "Ê≤°", py: "m√©i", mn: "kh√¥ng c√≥/ch∆∞a" }, { hz: "Âæà", py: "hƒõn", mn: "r·∫•t" }, { hz: "Â§™", py: "t√†i", mn: "qu√°/l·∫Øm" }, { hz: "ÈÉΩ", py: "d≈çu", mn: "ƒë·ªÅu" }, { hz: "Âíå", py: "h√©", mn: "v√†" }, { hz: "ÁöÑ", py: "de", mn: "c·ªßa/tr·ª£ t·ª´" }, { hz: "Âêó", py: "ma", mn: "kh√¥ng (h·ªèi)" }, { hz: "Âë¢", py: "ne", mn: "th√¨ sao/nh·ªâ" }, { hz: "‰∫Ü", py: "le", mn: "r·ªìi" }, { hz: "‰ªÄ‰πà", py: "sh√©nme", mn: "c√°i g√¨" }, { hz: "Âì™ÂÑø", py: "n«ér", mn: "·ªü ƒë√¢u" }, { hz: "ÊÄé‰πà", py: "zƒõnme", mn: "th·∫ø n√†o" }, { hz: "Â§öÂ∞ë", py: "du≈çshao", mn: "bao nhi√™u" }, { hz: "Âá†", py: "j«ê", mn: "m·∫•y" }
    ];

    const grammarBank = [
        { zh: "ÊàëÊòØÂ≠¶Áîü„ÄÇ", vi: "t√¥i l√† h·ªçc sinh", note: "C√¢u ch·ªØ ÊòØ (L√†): S + ÊòØ + O" },
        { zh: "ËøôÊòØ‰ªÄ‰πàÔºü", vi: "ƒë√¢y l√† c√°i g√¨", note: "C√¢u h·ªèi v·ªõi ‰ªÄ‰πà (C√°i g√¨)" },
        { zh: "‰ªñÂú®ÂÆ∂ÂêóÔºü", vi: "anh ·∫•y c√≥ ·ªü nh√† kh√¥ng", note: "C√¢u h·ªèi Âêó (C√≥... kh√¥ng)" },
        { zh: "‰Ω†ÂéªÂì™ÂÑøÔºü", vi: "b·∫°n ƒëi ƒë√¢u", note: "H·ªèi ƒë·ªãa ƒëi·ªÉm Âì™ÂÑø (·ªû ƒë√¢u)" },
        { zh: "Ëøô‰∏™Â§öÂ∞ëÈí±Ôºü", vi: "c√°i n√†y bao nhi√™u ti·ªÅn", note: "H·ªèi gi√° Â§öÂ∞ëÈí±" },
        { zh: "‰Ω†ÊòØÂì™ÂõΩ‰∫∫Ôºü", vi: "b·∫°n l√† ng∆∞·ªùi n∆∞·ªõc n√†o", note: "H·ªèi qu·ªëc t·ªãch" },
        { zh: "Áé∞Âú®Âá†ÁÇπÔºü", vi: "b√¢y gi·ªù l√† m·∫•y gi·ªù", note: "H·ªèi gi·ªù: Âá†ÁÇπ" },
        { zh: "‰Ω†‰ºöËØ¥Ê±âËØ≠ÂêóÔºü", vi: "b·∫°n bi·∫øt n√≥i ti·∫øng trung kh√¥ng", note: "ƒê·ªông t·ª´ nƒÉng nguy·ªán ‰ºö (Bi·∫øt)" },
        { zh: "‰ªñÁöÑ‰∏™Â≠êÂæàÈ´ò„ÄÇ", vi: "d√°ng ng∆∞·ªùi anh ·∫•y r·∫•t cao", note: "T√≠nh t·ª´ l√†m v·ªã ng·ªØ (Kh√¥ng d√πng ÊòØ)" },
        { zh: "ÊàëÊ≤°Èí±‰∫Ü„ÄÇ", vi: "t√¥i h·∫øt ti·ªÅn r·ªìi", note: "Ch·ªØ ‰∫Ü ch·ªâ s·ª± thay ƒë·ªïi tr·∫°ng th√°i" },
        { zh: "ÊàëÂíå‰ªñÊòØÂêåÂ≠¶„ÄÇ", vi: "t√¥i v√† anh ·∫•y l√† b·∫°n h·ªçc", note: "Li√™n t·ª´ Âíå (V√†)" },
        { zh: "Â§™ÁÉ≠‰∫ÜÔºÅ", vi: "n√≥ng qu√°", note: "C·∫•u tr√∫c c·∫£m th√°n: Â§™...‰∫Ü" },
        { zh: "ËøôÊú¨‰π¶ÊòØË∞ÅÁöÑÔºü", vi: "quy·ªÉn s√°ch n√†y l√† c·ªßa ai", note: "C√¢u s·ªü h·ªØu v·ªõi ÁöÑ" },
        { zh: "‰Ω†ÊÄé‰πàÂéªÂ≠¶Ê†°Ôºü", vi: "b·∫°n ƒëi ƒë·∫øn tr∆∞·ªùng b·∫±ng c√°ch n√†o", note: "H·ªèi ph∆∞∆°ng th·ª©c: ÊÄé‰πà + ƒê·ªông t·ª´" },
        { zh: "Êàë‰∏çÂñúÊ¨¢ÂêÉËãπÊûú„ÄÇ", vi: "t√¥i kh√¥ng th√≠ch ƒÉn t√°o", note: "Ph·ªß ƒë·ªãnh d√πng ‰∏ç" }
    ];

    const readingData = [
        { 
            id: 1, 
            zh: "‰Ω†Â•ΩÔºÅÊàëÂè´ÂàòÈìÅËä±„ÄÇÊàëÊòØÂ≠¶Áîü„ÄÇÊàëÂÆ∂Êúâ‰∫îÂè£‰∫∫ÔºöÁà∏Áà∏„ÄÅÂ¶àÂ¶à„ÄÅÂì•Âì•„ÄÅÂ•≥ÂÑøÂíåÊàë„ÄÇÊàëÁà∏Áà∏ÊòØËÄÅÂ∏àÔºå‰ªñÂú®Â≠¶Ê†°Â∑•‰Ωú„ÄÇÊàëÂ¶àÂ¶à‰∏çÂ∑•‰ΩúÔºåÂ•πÂú®ÂÆ∂„ÄÇÊàëÊúâ‰∏Ä‰∏™Â•ΩÊúãÂèãÔºå‰ªñÊòØÊàëÁöÑÂêåÂ≠¶„ÄÇËÆ§ËØÜ‰Ω†ÂæàÈ´òÂÖ¥ÔºÅ",
            key: "xin ch√†o t√¥i t√™n l∆∞u thi·∫øt hoa t√¥i l√† h·ªçc sinh nh√† t√¥i c√≥ nƒÉm ng∆∞·ªùi b·ªë m·∫π anh trai con g√°i v√† t√¥i b·ªë t√¥i l√† gi√°o vi√™n √¥ng ·∫•y l√†m vi·ªác ·ªü tr∆∞·ªùng m·∫π t√¥i kh√¥ng ƒëi l√†m b√† ·∫•y ·ªü nh√† t√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n t·ªët c·∫≠u ·∫•y l√† b·∫°n h·ªçc c·ªßa t√¥i r·∫•t vui ƒë∆∞·ª£c l√†m quen",
            vi_display: "Xin ch√†o! T√¥i t√™n L∆∞u Thi·∫øt Hoa. T√¥i l√† h·ªçc sinh. Nh√† t√¥i c√≥ 5 ng∆∞·ªùi: B·ªë, m·∫π, anh trai, con g√°i v√† t√¥i. B·ªë t√¥i l√† gi√°o vi√™n, √¥ng ·∫•y l√†m vi·ªác ·ªü tr∆∞·ªùng. M·∫π t√¥i kh√¥ng ƒëi l√†m, b√† ·∫•y ·ªü nh√†. T√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n t·ªët, c·∫≠u ·∫•y l√† b·∫°n h·ªçc c·ªßa t√¥i. R·∫•t vui ƒë∆∞·ª£c l√†m quen v·ªõi b·∫°n!"
        },
        { 
            id: 2, 
            zh: "‰ªäÂ§©ÊòüÊúüÂÖ≠„ÄÇÁé∞Âú®‰∏äÂçà‰πùÁÇπÔºåÊàëÂú®ÂÆ∂Áúã‰π¶„ÄÇ‰∏≠ÂçàÂçÅ‰∫åÁÇπÔºåÊàëÂéªÈ•≠Â∫óÂêÉÈ•≠„ÄÇÊàëÂñúÊ¨¢ÂêÉ‰∏≠ÂõΩËèúÔºåÂñùËå∂„ÄÇ‰∏ãÂçàÊàëË¶ÅÂéªÂïÜÂ∫ó‰π∞‰∏úË•ø„ÄÇÊàë‰π∞‰∫Ü‰∏Ä‰∏™ÊùØÂ≠êÂíåÂá†‰ª∂Ë°£Êúç„ÄÇÊòéÂ§©ÊòØÊòüÊúüÊó•ÔºåÊàë‰∏çÂ∑•‰ΩúÔºåÊàëÊÉ≥Âú®ÂÆ∂Áù°Ëßâ„ÄÇ",
            key: "h√¥m nay l√† th·ª© b·∫£y b√¢y gi·ªù l√† ch√≠n gi·ªù s√°ng t√¥i ·ªü nh√† ƒë·ªçc s√°ch m∆∞·ªùi hai gi·ªù tr∆∞a t√¥i ƒëi nh√† h√†ng ƒÉn c∆°m t√¥i th√≠ch ƒÉn m√≥n trung qu·ªëc u·ªëng tr√† bu·ªïi chi·ªÅu t√¥i mu·ªën ƒëi c·ª≠a h√†ng mua ƒë·ªì t√¥i ƒë√£ mua m·ªôt c√°i c·ªëc v√† v√†i b·ªô qu·∫ßn √°o ng√†y mai l√† ch·ªß nh·∫≠t t√¥i kh√¥ng l√†m vi·ªác t√¥i mu·ªën ·ªü nh√† ng·ªß",
            vi_display: "H√¥m nay l√† th·ª© b·∫£y. B√¢y gi·ªù l√† 9 gi·ªù s√°ng, t√¥i ·ªü nh√† ƒë·ªçc s√°ch. 12 gi·ªù tr∆∞a, t√¥i ƒëi nh√† h√†ng ƒÉn c∆°m. T√¥i th√≠ch ƒÉn m√≥n Trung Qu·ªëc, u·ªëng tr√†. Bu·ªïi chi·ªÅu t√¥i mu·ªën ƒëi c·ª≠a h√†ng mua ƒë·ªì. T√¥i ƒë√£ mua m·ªôt c√°i c·ªëc v√† v√†i b·ªô qu·∫ßn √°o. Ng√†y mai l√† ch·ªß nh·∫≠t, t√¥i kh√¥ng l√†m vi·ªác, t√¥i mu·ªën ·ªü nh√† ng·ªß."
        },
        { 
            id: 3, 
            zh: "ÂÖàÁîüÔºå‰Ω†Â•ΩÔºÅËØ∑ÈóÆÔºåÁé∞Âú®Âá†ÁÇπ‰∫ÜÔºüÁé∞Âú®‰∏âÁÇπÂçÅÂàÜ„ÄÇË∞¢Ë∞¢ÔºÅ‰∏çÂÆ¢Ê∞î„ÄÇ‰Ω†ÂéªÂì™ÂÑøÔºüÊàëÂéªÂ≠¶Ê†°ÁúãËÄÅÂ∏à„ÄÇ‰Ω†ÁöÑËÄÅÂ∏àÊòØË∞ÅÔºüÊàëÁöÑËÄÅÂ∏àÊòØÁéãÂÖàÁîü„ÄÇ‰ªñÂæàÂ•ΩÔºå‰πüÂæàÂøô„ÄÇ",
            key: "ch√†o √¥ng xin h·ªèi b√¢y gi·ªù l√† m·∫•y gi·ªù r·ªìi b√¢y gi·ªù l√† ba gi·ªù m∆∞·ªùi ph√∫t c·∫£m ∆°n kh√¥ng c√≥ g√¨ b·∫°n ƒëi ƒë√¢u t√¥i ƒëi ƒë·∫øn tr∆∞·ªùng thƒÉm gi√°o vi√™n gi√°o vi√™n c·ªßa b·∫°n l√† ai gi√°o vi√™n c·ªßa t√¥i l√† th·∫ßy v∆∞∆°ng √¥ng ·∫•y r·∫•t t·ªët c≈©ng r·∫•t b·∫≠n",
            vi_display: "Ch√†o √¥ng! Xin h·ªèi, b√¢y gi·ªù l√† m·∫•y gi·ªù r·ªìi? B√¢y gi·ªù l√† 3 gi·ªù 10 ph√∫t. C·∫£m ∆°n! Kh√¥ng c√≥ g√¨. B·∫°n ƒëi ƒë√¢u? T√¥i ƒëi ƒë·∫øn tr∆∞·ªùng thƒÉm gi√°o vi√™n. Gi√°o vi√™n c·ªßa b·∫°n l√† ai? Gi√°o vi√™n c·ªßa t√¥i l√† th·∫ßy V∆∞∆°ng. √îng ·∫•y r·∫•t t·ªët, c≈©ng r·∫•t b·∫≠n."
        },
        { 
            id: 4, 
            zh: "‰Ω†‰ºöËØ¥Ê±âËØ≠ÂêóÔºüÊàë‰ºöËØ¥‰∏ÄÁÇπÂÑø„ÄÇ‰Ω†ÂñúÊ¨¢ÂÅö‰ªÄ‰πàÔºüÊàëÂñúÊ¨¢ÁúãÁîµËßÜÂíåÂê¨ËÄÅÂ∏àËØ¥ËØù„ÄÇÊàë‰∏çÂñúÊ¨¢ÂñùÊ∞¥ÔºåÊàëÂñúÊ¨¢ÂñùËå∂„ÄÇ‰ªäÂ§©Â§©Ê∞îÂæàÁÉ≠ÔºåÊàëÊÉ≥ÂêÉËãπÊûú„ÄÇ‰Ω†Âë¢ÔºüÊàë‰πü‰∏ÄÊ†∑„ÄÇ",
            key: "b·∫°n bi·∫øt n√≥i ti·∫øng trung kh√¥ng t√¥i bi·∫øt n√≥i m·ªôt ch√∫t b·∫°n th√≠ch l√†m g√¨ t√¥i th√≠ch xem tivi v√† nghe th·∫ßy gi√°o n√≥i chuy·ªán t√¥i kh√¥ng th√≠ch u·ªëng n∆∞·ªõc t√¥i th√≠ch u·ªëng tr√† h√¥m nay th·ªùi ti·∫øt r·∫•t n√≥ng t√¥i mu·ªën ƒÉn t√°o c√≤n b·∫°n th√¨ sao t√¥i c≈©ng v·∫≠y",
            vi_display: "B·∫°n bi·∫øt n√≥i ti·∫øng Trung kh√¥ng? T√¥i bi·∫øt n√≥i m·ªôt ch√∫t. B·∫°n th√≠ch l√†m g√¨? T√¥i th√≠ch xem tivi v√† nghe th·∫ßy gi√°o n√≥i chuy·ªán. T√¥i kh√¥ng th√≠ch u·ªëng n∆∞·ªõc, t√¥i th√≠ch u·ªëng tr√†. H√¥m nay th·ªùi ti·∫øt r·∫•t n√≥ng, t√¥i mu·ªën ƒÉn t√°o. C√≤n b·∫°n th√¨ sao? T√¥i c≈©ng v·∫≠y."
        },
        { 
            id: 5, 
            zh: "Ëøô‰∏™ÁîµËÑëÂ§öÂ∞ëÈí±ÔºüËøô‰∏™ÁîµËÑëÂÖ´ÂçÉÂùóÈí±„ÄÇÂ§™Ë¥µ‰∫ÜÔºÅÈÇ£‰∏™Ê°åÂ≠êÂíåÊ§ÖÂ≠êÂë¢ÔºüÈÇ£‰∏™Ê°åÂ≠ê‰∏çË¥µ„ÄÇ‰Ω†Ë¶Å‰π∞‰ªÄ‰πàÔºüÊàëË¶Å‰π∞‰∏Ä‰∏™Â∞èÊùØÂ≠ê„ÄÇÁªô‰Ω†Èí±„ÄÇË∞¢Ë∞¢„ÄÇ",
            key: "c√°i m√°y t√≠nh n√†y bao nhi√™u ti·ªÅn c√°i m√°y t√≠nh n√†y t√°m ngh√¨n t·ªá ƒë·∫Øt qu√° c√°i b√†n v√† gh·∫ø kia th√¨ sao c√°i b√†n ƒë√≥ kh√¥ng ƒë·∫Øt b·∫°n mu·ªën mua g√¨ t√¥i mu·ªën mua m·ªôt c√°i c·ªëc nh·ªè g·ª≠i b·∫°n ti·ªÅn c·∫£m ∆°n",
            vi_display: "C√°i m√°y t√≠nh n√†y bao nhi√™u ti·ªÅn? C√°i m√°y t√≠nh n√†y 8000 t·ªá. ƒê·∫Øt qu√°! C√°i b√†n v√† gh·∫ø kia th√¨ sao? C√°i b√†n ƒë√≥ kh√¥ng ƒë·∫Øt. B·∫°n mu·ªën mua g√¨? T√¥i mu·ªën mua m·ªôt c√°i c·ªëc nh·ªè. G·ª≠i b·∫°n ti·ªÅn. C·∫£m ∆°n."
        },
        { 
            id: 6, 
            zh: "‰ªäÂ§©ÊòØÊòüÊúü‰∫îÔºåÂ§©Ê∞îÂæàÁÉ≠„ÄÇÁé∞Âú®‰∏äÂçàÂÖ´ÁÇπÔºåÊàë‰∏çÂú®ÂÆ∂ÔºåÊàëÂú®Â≠¶Ê†°„ÄÇÊàëÊòØËøôÈáåÁöÑÂ≠¶ÁîüÔºåÊàë‰πüËÆ§ËØÜÂæàÂ§öÂêåÂ≠¶ÂíåËÄÅÂ∏à„ÄÇÊàëÁöÑËÄÅÂ∏àÊòØ‰ΩçÂÖàÁîüÔºå‰ªñÂæàÂ•ΩÔºå‰ΩÜÊòØ‰ªñ‰ªäÂ§©ÂæàÂøô„ÄÇ",
            key: "h√¥m nay l√† th·ª© s√°u th·ªùi ti·∫øt r·∫•t n√≥ng b√¢y gi·ªù l√† t√°m gi·ªù s√°ng t√¥i kh√¥ng ·ªü nh√† t√¥i ·ªü tr∆∞·ªùng t√¥i l√† h·ªçc sinh ·ªü ƒë√¢y t√¥i c≈©ng quen bi·∫øt r·∫•t nhi·ªÅu b·∫°n h·ªçc v√† th·∫ßy c√¥ gi√°o vi√™n c·ªßa t√¥i l√† m·ªôt qu√Ω √¥ng √¥ng ·∫•y r·∫•t t·ªët nh∆∞ng h√¥m nay √¥ng ·∫•y r·∫•t b·∫≠n",
            vi_display: "H√¥m nay l√† th·ª© s√°u, th·ªùi ti·∫øt r·∫•t n√≥ng. B√¢y gi·ªù l√† 8 gi·ªù s√°ng, t√¥i kh√¥ng ·ªü nh√†, t√¥i ·ªü tr∆∞·ªùng. T√¥i l√† h·ªçc sinh ·ªü ƒë√¢y, t√¥i c≈©ng quen bi·∫øt r·∫•t nhi·ªÅu b·∫°n h·ªçc v√† th·∫ßy c√¥. Gi√°o vi√™n c·ªßa t√¥i l√† m·ªôt qu√Ω √¥ng, √¥ng ·∫•y r·∫•t t·ªët, nh∆∞ng h√¥m nay √¥ng ·∫•y r·∫•t b·∫≠n."
        },
        { 
            id: 7, 
            zh: "‰Ω†Â•ΩÔºÅËØ∑ÈóÆ‰Ω†ÊòØË∞ÅÔºüÊàëÊòØÁéãÂ∞èÂßêÔºåÊàëÊòØ‰Ω†Áà∏Áà∏ÁöÑÊúãÂèã„ÄÇÂô¢ÔºÅÁéãÂ∞èÂßêÔºåÂø´ËØ∑ËøõÔºåËØ∑ÂùêÂú®ËøôÂÑøÁöÑÊ§ÖÂ≠ê‰∏ä„ÄÇ‰Ω†ËÆ§ËØÜÊàëÁöÑÂ•≥ÂÑøÂêóÔºüÊàë‰∏çËÆ§ËØÜÂ•πÔºåÂ•πÊòØË∞ÅÔºüÂ•πÊòØÊàëÁöÑÂ§ßÂ•≥ÂÑøÔºå‰ªñÂú®Âåó‰∫¨ËØªÂ§ßÂ≠¶ÔºåÁé∞Âú®Âú®ÂÆ∂ÈáåÁúãÁîµËßÜ„ÄÇ",
            key: "xin ch√†o xin h·ªèi c√¥ l√† ai t√¥i l√† c√¥ v∆∞∆°ng t√¥i l√† b·∫°n c·ªßa b·ªë b·∫°n ·ªì c√¥ v∆∞∆°ng mau m·ªùi v√†o m·ªùi ng·ªìi tr√™n c√°i gh·∫ø ·ªü ƒë√¢y c√¥ c√≥ bi·∫øt con g√°i t√¥i kh√¥ng t√¥i kh√¥ng bi·∫øt c√¥ ·∫•y c√¥ ·∫•y l√† ai c√¥ ·∫•y l√† con g√°i l·ªõn c·ªßa t√¥i n√≥ ƒëang h·ªçc ƒë·∫°i h·ªçc ·ªü b·∫Øc kinh b√¢y gi·ªù ƒëang ·ªü nh√† xem tivi",
            vi_display: "Xin ch√†o! Xin h·ªèi c√¥ l√† ai? T√¥i l√† c√¥ V∆∞∆°ng, t√¥i l√† b·∫°n c·ªßa b·ªë b·∫°n. ·ªí! C√¥ V∆∞∆°ng, mau m·ªùi v√†o, m·ªùi ng·ªìi tr√™n c√°i gh·∫ø ·ªü ƒë√¢y. C√¥ c√≥ bi·∫øt con g√°i t√¥i kh√¥ng? T√¥i kh√¥ng bi·∫øt c√¥ ·∫•y, c√¥ ·∫•y l√† ai? C√¥ ·∫•y l√† con g√°i l·ªõn c·ªßa t√¥i, n√≥ ƒëang h·ªçc ƒë·∫°i h·ªçc ·ªü B·∫Øc Kinh, b√¢y gi·ªù ƒëang ·ªü nh√† xem tivi."
        },
        { 
            id: 8, 
            zh: "ÊàëÊòØ‰∏Ä‰∏™ÂñúÊ¨¢Â≠¶‰π†ÁöÑ‰∫∫„ÄÇÁé∞Âú®Êàë‰∏çÂú®Â∑•‰ΩúÔºåÊàëÂú®Â≠¶‰π†„ÄÇÊàë‰ºöËØ¥Ê±âËØ≠Ôºå‰πü‰ºöËØªÊ±âËØ≠‰π¶Ôºå‰ΩÜÊòØÊàë‰∏ç‰ºöÂÜôÂæàÂ§öÂ≠ó„ÄÇÊàëÁöÑÂêåÂ≠¶Â§™Â§ö‰∫ÜÔºå‰ªñ‰ª¨ÈÉΩÂæàÂä™Âäõ„ÄÇ‰ªäÂ§©‰∏äÂçàÔºåËÄÅÂ∏àËØ¥Êàë‰ª¨Ë¶ÅÂÅöÂæàÂ§ö‰Ωú‰∏ö„ÄÇËøô‰∫õ‰Ωú‰∏ö‰∏çÂ§ß‰πü‰∏çÂ∞èÔºå‰ΩÜÊòØÂæàÈöæ„ÄÇ",
            key: "t√¥i l√† m·ªôt ng∆∞·ªùi th√≠ch h·ªçc t·∫≠p b√¢y gi·ªù t√¥i kh√¥ng l√†m vi·ªác t√¥i ƒëang h·ªçc t√¥i bi·∫øt n√≥i ti·∫øng trung c≈©ng bi·∫øt ƒë·ªçc s√°ch ti·∫øng trung nh∆∞ng t√¥i kh√¥ng bi·∫øt vi·∫øt nhi·ªÅu ch·ªØ b·∫°n h·ªçc c·ªßa t√¥i ƒë√¥ng qu√° h·ªç ƒë·ªÅu r·∫•t n·ªó l·ª±c s√°ng nay th·∫ßy gi√°o n√≥i ch√∫ng t√¥i ph·∫£i l√†m r·∫•t nhi·ªÅu b√†i t·∫≠p nh·ªØng b√†i t·∫≠p n√†y kh√¥ng l·ªõn c≈©ng kh√¥ng nh·ªè nh∆∞ng r·∫•t kh√≥",
            vi_display: "T√¥i l√† m·ªôt ng∆∞·ªùi th√≠ch h·ªçc t·∫≠p. B√¢y gi·ªù t√¥i kh√¥ng l√†m vi·ªác, t√¥i ƒëang h·ªçc. T√¥i bi·∫øt n√≥i ti·∫øng Trung, c≈©ng bi·∫øt ƒë·ªçc s√°ch ti·∫øng Trung, nh∆∞ng t√¥i kh√¥ng bi·∫øt vi·∫øt nhi·ªÅu ch·ªØ. B·∫°n h·ªçc c·ªßa t√¥i ƒë√¥ng qu√°, h·ªç ƒë·ªÅu r·∫•t n·ªó l·ª±c. S√°ng nay, th·∫ßy gi√°o n√≥i ch√∫ng t√¥i ph·∫£i l√†m r·∫•t nhi·ªÅu b√†i t·∫≠p. Nh·ªØng b√†i t·∫≠p n√†y kh√¥ng l·ªõn c≈©ng kh√¥ng nh·ªè, nh∆∞ng r·∫•t kh√≥."
        },
        {
            id: 9,
            zh: "ÊùéÂ∞èÂßêÂæàÊºÇ‰∫Æ„ÄÇÂ•πÂñúÊ¨¢ÂêÉ‰∏≠ÂõΩËèúÔºå‰∏çÂñúÊ¨¢ÂêÉËãπÊûú„ÄÇÂ•πÊÉ≥ÂñùËå∂Ôºå‰∏çÊÉ≥ÂñùÊ∞¥„ÄÇ‰ªäÂ§©Â§©Ê∞îÂæàÂÜ∑ÔºåÂ•πÂú®ÂÆ∂ÈáåÂñùÁÉ≠Ëå∂„ÄÇÂ•πÂæàÈ´òÂÖ¥„ÄÇ",
            key: "c√¥ l√Ω r·∫•t xinh ƒë·∫πp c√¥ ·∫•y th√≠ch ƒÉn m√≥n trung qu·ªëc kh√¥ng th√≠ch ƒÉn t√°o c√¥ ·∫•y mu·ªën u·ªëng tr√† kh√¥ng mu·ªën u·ªëng n∆∞·ªõc h√¥m nay th·ªùi ti·∫øt r·∫•t l·∫°nh c√¥ ·∫•y ·ªü nh√† u·ªëng tr√† n√≥ng c√¥ ·∫•y r·∫•t vui",
            vi_display: "C√¥ L√Ω r·∫•t xinh ƒë·∫πp. C√¥ ·∫•y th√≠ch ƒÉn m√≥n Trung Qu·ªëc, kh√¥ng th√≠ch ƒÉn t√°o. C√¥ ·∫•y mu·ªën u·ªëng tr√†, kh√¥ng mu·ªën u·ªëng n∆∞·ªõc. H√¥m nay th·ªùi ti·∫øt r·∫•t l·∫°nh, c√¥ ·∫•y ·ªü nh√† u·ªëng tr√† n√≥ng. C√¥ ·∫•y r·∫•t vui."
        }
    ];

    const vPop = [{name:"H√¥n v√†o ƒë√¢y",type:"mp4",id:"https://files.catbox.moe/kos9gw.mp4",thumb:"https://img.youtube.com/vi/vs-hsW6I63I/mqdefault.jpg"},{name:"H√† N·ªôi",type:"mp4",id:"https://files.catbox.moe/1ygyge.mp4",thumb:"https://img.youtube.com/vi/OerAX-zKyvg/mqdefault.jpg"}];
    const cPop = [{name:"Mang Ch·ªßng (M·ªõi)",type:"mp4",id:"https://files.catbox.moe/g2tdte.mp4",thumb:"https://img.youtube.com/vi/vgbrIy08e2w/mqdefault.jpg"},{name:"T√¢m L·∫∑ng Nh∆∞ N∆∞·ªõc",type:"mp4",id:"https://files.catbox.moe/p42gvs.mp4",thumb:"https://img.youtube.com/vi/ae9JqrRNWLk/mqdefault.jpg"},{name:"T·ª´ C·ª≠u M√¥n H·ªìi ·ª®c",type:"mp4",id:"https://files.catbox.moe/cqqpwx.mp4",thumb:"https://img.youtube.com/vi/IE7uUnMClsw/hqdefault.jpg"},{name:"Tam B√°i H·ªìng Tr·∫ßn L∆∞∆°ng",type:"mp4",id:"https://files.catbox.moe/f3yf9a.mp4",thumb:"https://img.youtube.com/vi/esWdcDSSrvE/hqdefault.jpg"}];

    // --- LOGIC GHI NH·ªö & KI·ªÇM TRA (AI SIMULATION) ---
    const grammarRules = [
        { id: "g1", struct: "S + ÊòØ + n", name: "C√¢u kh·∫≥ng ƒë·ªãnh", ex: "ÊàëÊòØËÄÅÂ∏à", keywords: ["ÊòØ"], desc: "Ch·ªß ng·ªØ + ÊòØ + Danh t·ª´" },
        { id: "g2", struct: "S + ‰∏ç + ÊòØ + n", name: "C√¢u ph·ªß ƒë·ªãnh", ex: "Êàë‰∏çÊòØÂ≠¶Áîü", keywords: ["‰∏ç", "ÊòØ"], desc: "Ch·ªß ng·ªØ + ‰∏ç + ÊòØ + Danh t·ª´" },
        { id: "g3", struct: "S + ÊòØ + n + Âêó", name: "C√¢u nghi v·∫•n", ex: "‰Ω†ÊòØÂåªÁîüÂêóÔºü", keywords: ["ÊòØ", "Âêó"], desc: "Ch·ªß ng·ªØ + ÊòØ + Danh t·ª´ + Âêó" },
        { id: "g4", struct: "ƒê·∫°i t·ª´ + ‰ª¨", name: "S·ªë nhi·ªÅu", ex: "Êàë‰ª¨", keywords: ["‰ª¨"], desc: "Th√™m ‰ª¨ sau ƒë·∫°i t·ª´" }
    ];

    const quizBank = [
        { sent: "‰Ω†ÊòØËÄÅÂ∏àÂêóÔºü", type: "g3", s: "‰Ω†", n: "ËÄÅÂ∏à" },
        { sent: "Êàë‰∏çÊòØÂåªÁîü„ÄÇ", type: "g2", s: "Êàë", n: "ÂåªÁîü" },
        { sent: "‰ªñÊòØÂ≠¶Áîü„ÄÇ", type: "g1", s: "‰ªñ", n: "Â≠¶Áîü" }
    ];

    function renderStudyTab() {
        const container = document.getElementById('grammar-list-container');
        container.innerHTML = "";
        grammarRules.forEach(rule => {
            const div = document.createElement('div');
            div.className = "grammar-box";
            div.innerHTML = `<h3 class="text-xl font-bold text-yellow-400">${rule.struct}</h3><p class="text-gray-300 italic">${rule.name}</p><div class="bg-black/30 p-4 rounded mt-2"><p class="font-bold">${rule.ex}</p></div>`;
            container.appendChild(div);
        });
    }

    let currentQuiz = null, quizStep = 0;
    function startGrammarTest() {
        document.getElementById('test-menu').classList.add('hidden');
        document.getElementById('grammar-test-ui').classList.remove('hidden');
        currentQuiz = quizBank[Math.floor(Math.random() * quizBank.length)];
        quizStep = 0;
        document.getElementById('gt-question').innerText = currentQuiz.sent;
        document.getElementById('gt-prompt').innerText = "AI: C√¢u n√†y d√πng ng·ªØ ph√°p g√¨?";
        document.getElementById('gt-feedback').innerText = "";
        
        const optDiv = document.getElementById('gt-options');
        optDiv.innerHTML = ""; optDiv.classList.remove('hidden');
        document.getElementById('gt-input').classList.add('hidden');
        
        grammarRules.forEach(rule => {
            const btn = document.createElement('button');
            btn.className = "p-3 bg-white/10 hover:bg-pink-600 rounded text-left border border-white/20";
            btn.innerText = rule.struct;
            btn.onclick = () => submitStep1(rule.id);
            optDiv.appendChild(btn);
        });
    }

    function submitStep1(id) {
        if(id === currentQuiz.type) { nextStep(1, "ƒê√∫ng! +1 Coin", "AI: T√¨m CH·ª¶ NG·ªÆ?"); updateCoins(1); }
        else { document.getElementById('gt-feedback').innerText = "Sai r·ªìi!"; updateCoins(-1); }
    }

    function nextStep(step, fb, prompt) {
        quizStep = step;
        document.getElementById('gt-feedback').innerText = fb;
        document.getElementById('gt-prompt').innerText = prompt;
        if(step > 0) {
            document.getElementById('gt-options').classList.add('hidden');
            document.getElementById('gt-input').classList.remove('hidden');
            document.getElementById('gt-input').value = "";
        }
    }

    function checkGrammarStep() {
        const val = document.getElementById('gt-input').value.trim();
        if(quizStep === 1) {
            if(val === currentQuiz.s) nextStep(2, "ƒê√∫ng ch·ªß ng·ªØ! +1 Coin", "AI: T√¨m DANH T·ª™?");
            else document.getElementById('gt-feedback').innerText = "Sai ch·ªß ng·ªØ!";
        } else if (quizStep === 2) {
            if(val === currentQuiz.n) nextStep(3, "ƒê√∫ng danh t·ª´! +1 Coin", "AI: T·ª± ƒë·∫∑t 1 c√¢u m·ªõi?");
            else document.getElementById('gt-feedback').innerText = "Sai danh t·ª´!";
        } else if (quizStep === 3) {
             const rule = grammarRules.find(r => r.id === currentQuiz.type);
             if(rule.keywords.every(k => val.includes(k))) {
                 document.getElementById('gt-feedback').innerText = "C√¢u t·ªët! +5 Coin"; updateCoins(5);
                 setTimeout(startGrammarTest, 2000);
             } else {
                 document.getElementById('gt-feedback').innerText = "Thi·∫øu t·ª´ kh√≥a quan tr·ªçng!";
             }
        }
    }

    function startFillBlankTest() {
        document.getElementById('test-menu').classList.add('hidden');
        document.getElementById('fill-test-ui').classList.remove('hidden');
        const s = vocabData[Math.floor(Math.random()*vocabData.length)];
        const v = vocabData[Math.floor(Math.random()*vocabData.length)];
        document.getElementById('ft-dialogue').innerHTML = `<div class="chat-bubble">A: ‰Ω†Â•ΩÔºÅ</div><br><div class="chat-bubble">B: Êàë <span class="fill-blank" id="blank-slot">____</span> ${v.hz}„ÄÇ</div>`;
        
        const options = [s];
        while(options.length < 4) {
            const r = vocabData[Math.floor(Math.random()*vocabData.length)];
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);
        
        const optDiv = document.getElementById('ft-options');
        optDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "px-4 py-2 bg-white/10 hover:bg-green-500 rounded border";
            btn.innerText = opt.hz;
            btn.onclick = () => {
                if(opt === s) {
                    document.getElementById('blank-slot').innerText = opt.hz;
                    document.getElementById('ft-feedback').innerText = "CH√çNH X√ÅC! +2 COIN";
                    updateCoins(2);
                    setTimeout(startFillBlankTest, 1500);
                } else {
                    document.getElementById('ft-feedback').innerText = "SAI R·ªíI";
                    updateCoins(-1);
                }
            };
            optDiv.appendChild(btn);
        });
    }

    function closeTestUI() {
        document.getElementById('test-menu').classList.remove('hidden');
        document.getElementById('grammar-test-ui').classList.add('hidden');
        document.getElementById('fill-test-ui').classList.add('hidden');
    }

    // --- INIT ---
    let vMode=0, vIdx=0, rIdx=0, isShowingAnswer=false, remainingIndices=[];
    function initVocabSystem() { const s = localStorage.getItem('skyVocabProgress'); if(s) try { remainingIndices = JSON.parse(s); if(!Array.isArray(remainingIndices)||remainingIndices.length===0) resetVocabProgress(); } catch(e){ resetVocabProgress(); } else resetVocabProgress(); }
    function resetVocabProgress() { remainingIndices = Array.from({length:vocabData.length},(_,i)=>i); localStorage.setItem('skyVocabProgress',JSON.stringify(remainingIndices)); }
    function switchTab(id) { document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); document.getElementById(id).classList.add('active'); document.getElementById('n-'+id).classList.add('active'); if(id==='vocab'){initVocabSystem();nextVocab(true);} if(id==='speaking')updateSpeakUI(); if(id==='grammar')nextGrammar(); if(id==='reading')nextParagraph(); if(id==='study')renderStudyTab(); }
    
    // --- RESTORE ORIGINAL FUNCTIONS (Minified to save space but logic 100% same) ---
    function nextParagraph(){let newIdx;do{newIdx=Math.floor(Math.random()*readingData.length);}while(newIdx===rIdx&&readingData.length>1);rIdx=newIdx;const item=readingData[rIdx];document.getElementById('r-text').innerText=item.zh;document.getElementById('r-input').value="";document.getElementById('r-msg').innerText="";document.getElementById('r-toggle-btn').innerText="Xem ƒê√°p √Ån (Vi·ªát)";isShowingAnswer=false;}
    function toggleReadingRef(){const txt=document.getElementById('r-text');const btn=document.getElementById('r-toggle-btn');const item=readingData[rIdx];isShowingAnswer=!isShowingAnswer;if(isShowingAnswer){txt.innerText=item.vi_display;btn.innerText="Xem C√¢u H·ªèi (Trung)";}else{txt.innerText=item.zh;btn.innerText="Xem ƒê√°p √Ån (Vi·ªát)";}}
    function checkReading(){const input=document.getElementById('r-input').value.trim().toLowerCase();const target=readingData[rIdx].key;const card=document.getElementById('reading-card');const inputWords=input.split(/\s+/);const targetWords=target.split(/\s+/);let matchCount=0;inputWords.forEach(word=>{if(target.includes(word))matchCount++;});const score=matchCount/targetWords.length;if(score>0.5){updateCoins(1);document.getElementById('r-msg').innerText=`R·∫§T T·ªêT! (${Math.round(score*100)}%)`;document.getElementById('r-msg').style.color="#4ade80";card.classList.add('glow-green');}else{updateCoins(-1);document.getElementById('r-msg').innerText=`CH∆ØA ƒê·∫†T (${Math.round(score*100)}%)`;document.getElementById('r-msg').style.color="#f87171";card.classList.add('glow-red');}}
    function nextVocab(random=true){if(remainingIndices.length===0){if(confirm("B·∫°n ƒë√£ ho√†n th√†nh 150 t·ª´ v·ª±ng! C√≥ mu·ªën h·ªçc l·∫°i kh√¥ng?")){resetVocabProgress();}else{return;}}if(random){const randomIndex=Math.floor(Math.random()*remainingIndices.length);vIdx=remainingIndices[randomIndex];}const item=vocabData[vIdx];document.getElementById('v-question').innerText=vMode===0?item.hz:(vMode===1?item.mn.toUpperCase():item.hz);document.getElementById('v-input').value="";document.getElementById('v-msg').innerText="";document.getElementById('v-hint').innerText="";document.getElementById('v-hint').classList.add('hidden');document.getElementById('vocab-card').classList.remove('glow-green','glow-red');}
    function checkVocab(){const item=vocabData[vIdx];const val=document.getElementById('v-input').value.trim().toLowerCase();let correct=false;if(vMode===0)correct=val===item.mn.toLowerCase();else if(vMode===1)correct=val===item.hz;else correct=val===item.py.toLowerCase()||val===item.py.normalize("NFD").replace(/[\u0300-\u036f]/g,"");const feedback=document.getElementById('v-msg');const hint=document.getElementById('v-hint');if(correct){updateCoins(1);feedback.innerText="CH√çNH X√ÅC!";feedback.style.color="#4ade80";document.getElementById('vocab-card').classList.add('glow-green');speakText(item.hz);hint.classList.add('hidden');remainingIndices=remainingIndices.filter(id=>id!==vIdx);localStorage.setItem('skyVocabProgress',JSON.stringify(remainingIndices));setTimeout(()=>nextVocab(true),1200);}else{updateCoins(-1);feedback.innerText="SAI R·ªíI";feedback.style.color="#f87171";hint.innerText="ƒê√ÅP √ÅN: "+(vMode===0?item.mn.toUpperCase():item.hz);hint.classList.remove('hidden');document.getElementById('vocab-card').classList.add('glow-red');speakText(item.hz);}}
    function changeVocabMode(){vMode=(vMode+1)%3;const labels=["H√°n ‚ûî Vi·ªát","Vi·ªát ‚ûî H√°n","H√°n ‚ûî Pinyin"];document.getElementById('v-mode-btn').innerText="Mode: "+labels[vMode];nextVocab(false);}
    function updateSpeakUI(){const item=vocabData[sIdx];document.getElementById('s-hz').innerText=item.hz;document.getElementById('s-py').innerText=item.py;document.getElementById('s-mn').innerText=item.mn.toUpperCase();document.getElementById('speak-card').classList.remove('glow-green','glow-red');document.getElementById('s-status').innerText="B·∫•m mic v√† n√≥i ngay";document.getElementById('s-live-text').innerText="";}
    function changeSpeakWord(dir){sIdx=(sIdx+dir+vocabData.length)%vocabData.length;updateSpeakUI();}
    function toggleGrammarMode(){gMode=1-gMode;document.getElementById('g-mode-badge').innerText=gMode===0?"Trung ‚ûî Vi·ªát":"Vi·ªát ‚ûî Trung";nextGrammar();}
    function nextGrammar(){let newIdx;do{newIdx=Math.floor(Math.random()*grammarBank.length);}while(newIdx===gIdx&&grammarBank.length>1);gIdx=newIdx;const item=grammarBank[gIdx];document.getElementById('g-question').innerText=gMode===0?item.zh:item.vi.toUpperCase();document.getElementById('g-instruction').innerText=gMode===0?"D·ªãch c√¢u n√†y sang Ti·∫øng Vi·ªát":"D·ªãch c√¢u n√†y sang Ti·∫øng Trung";document.getElementById('g-input').value="";document.getElementById('g-msg').innerText="";document.getElementById('g-note').innerText="";document.getElementById('grammar-card').className="glass-card p-10 w-full max-w-2xl mx-4 relative overflow-hidden";if(gMode===0)speakText(item.zh);}
    function checkGrammar(){const val=document.getElementById('g-input').value.trim().toLowerCase();const item=grammarBank[gIdx];const target=gMode===0?item.vi:item.zh;const card=document.getElementById('grammar-card');let isCorrect=false;if(gMode===0)isCorrect=val===target.toLowerCase()||(target.toLowerCase().includes(val)&&val.length>5);else isCorrect=val===target||val===target.replace(/Ôºü|„ÄÇ/g,"");speakText(item.zh);if(isCorrect){updateCoins(1);document.getElementById('g-msg').innerText="R·∫§T T·ªêT!";card.classList.add('glow-green');setTimeout(nextGrammar,2000);}else{updateCoins(-1);document.getElementById('g-msg').innerText="CH∆ØA CH√çNH X√ÅC";document.getElementById('g-msg').style.color="#f87171";document.getElementById('g-note').innerHTML=`<span class="text-red-400">ƒê√ÅP √ÅN: ${target}</span>`;card.classList.add('glow-red');}}
    const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;let recognition;let timer;if(SpeechRecognition){recognition=new SpeechRecognition();recognition.lang='zh-CN';recognition.interimResults=true;recognition.continuous=true;const btn=document.getElementById('mic-btn');const status=document.getElementById('s-status');const progressBar=document.getElementById('progress-bar');const card=document.getElementById('speak-card');const liveText=document.getElementById('s-live-text');let isListening=false;btn.onclick=()=>{if(isListening)return;startSession();};function startSession(){isListening=true;card.classList.remove('glow-green','glow-red');status.innerText="ƒêANG NGHE...";progressBar.style.width='100%';progressBar.style.transition="width 5s linear";try{recognition.start();}catch(e){}timer=setTimeout(()=>{finishSession("TIMEOUT");},5000);}recognition.onresult=(e)=>{let interim="";for(let i=e.resultIndex;i<e.results.length;++i){interim+=e.results[i][0].transcript;}liveText.innerText="Nghe: "+interim;const target=vocabData[sIdx].hz;const clean=interim.replace(/[.,?„ÄÇÔºü!ÔºÅ]/g,"");if(clean.includes(target)||(homophones[target]&&homophones[target].some(h=>clean.includes(h)))){finishSession("WIN",clean);}};recognition.onerror=()=>{finishSession("ERROR");};recognition.onend=()=>{if(isListening){try{recognition.start()}catch(e){}}};function finishSession(type,word=""){if(!isListening)return;isListening=false;clearTimeout(timer);recognition.stop();progressBar.style.transition="none";progressBar.style.width='0%';if(type==="WIN"){updateCoins(1);status.innerText="CH√çNH X√ÅC!";card.classList.add('glow-green');}else{status.innerText="TH·ª¨ L·∫†I";card.classList.add('glow-red');}}}

    // --- GAME 3D LOGIC (V39 SAFE ENV + V35 STRICT ANIMATION) ---
    let gameInited = false, scene, camera, renderer, playerModel, mixer;
    let keys = { w: false, a: false, s: false, d: false, shift: false };
    let clock = new THREE.Clock(), actions = {}, activeAction;

    function enterGameWorld() { document.getElementById('game-container').style.display = 'block'; if(!gameInited) initGame(); }
    function exitGameWorld() { document.getElementById('game-container').style.display = 'none'; }
    function initGame() {
        gameInited = true;
        const container = document.getElementById('game-container');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);
        
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.5); scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5); dirLight.position.set(10, 20, 10); scene.add(dirLight);

        // Env
        const texLoader = new THREE.TextureLoader();
        texLoader.load('./blackg.jpg', (tex) => { scene.background = tex; }, undefined, () => { console.log("Missing BG"); });
        const groundMat = new THREE.MeshStandardMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true });
        texLoader.load('./sanh.png', (tex) => { tex.repeat.set(1, 1); groundMat.map = tex; groundMat.needsUpdate = true; });
        const ground = new THREE.Mesh(new THREE.PlaneGeometry(30, 30), groundMat);
        ground.rotation.x = -Math.PI / 2; scene.add(ground);

        // Player
        new THREE.GLTFLoader().load('./men.glb', (gltf) => {
            playerModel = gltf.scene; scene.add(playerModel);
            mixer = new THREE.AnimationMixer(playerModel);
            const clips = gltf.animations;
            const getClip = (name, exclude) => clips.find(c => c.name.toLowerCase().includes(name.toLowerCase()) && !exclude.some(ex => c.name.toLowerCase().includes(ex.toLowerCase())));
            
            const idle = getClip('Idle', ['to','Walk']) || clips[0];
            const walk = getClip('Walk', ['to','Idle']);
            const run = getClip('Run', ['to','Walk']);
            
            if(idle) { actions['Idle'] = mixer.clipAction(idle); actions['Idle'].play(); }
            if(walk) actions['Walk'] = mixer.clipAction(walk);
            if(run) actions['Run'] = mixer.clipAction(run);
            activeAction = actions['Idle'];
            animate();
        });

        document.addEventListener('keydown', (e) => { if(e.key=='w') keys.w=true; if(e.key=='a') keys.a=true; if(e.key=='s') keys.s=true; if(e.key=='d') keys.d=true; if(e.key=='Shift') keys.shift=true; });
        document.addEventListener('keyup', (e) => { if(e.key=='w') keys.w=false; if(e.key=='a') keys.a=false; if(e.key=='s') keys.s=false; if(e.key=='d') keys.d=false; if(e.key=='Shift') keys.shift=false; });
    }

    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        if(playerModel && mixer) {
            let speed = 0, move = 'Idle';
            if(keys.w || keys.s || keys.a || keys.d) {
                speed = keys.shift ? 8 : 4; move = keys.shift ? 'Run' : 'Walk';
                if(keys.w) playerModel.position.z -= speed * delta;
                if(keys.s) playerModel.position.z += speed * delta;
                if(keys.a) playerModel.position.x -= speed * delta;
                if(keys.d) playerModel.position.x += speed * delta;
                let angle = 0; if(keys.w) angle = Math.PI; if(keys.s) angle = 0; if(keys.a) angle = -Math.PI/2; if(keys.d) angle = Math.PI/2;
                playerModel.rotation.y = angle;
            }
            if(activeAction !== actions[move] && actions[move]) { activeAction.fadeOut(0.2); activeAction = actions[move]; activeAction.reset().fadeIn(0.2).play(); }
            mixer.update(delta);
            camera.position.set(playerModel.position.x, playerModel.position.y + 7, playerModel.position.z + 10);
            camera.lookAt(playerModel.position);
        }
        renderer.render(scene, camera);
    }

    document.getElementById('v-input').addEventListener("keypress", function(event) { if (event.key === "Enter") checkVocab(); });
    document.getElementById('r-input').addEventListener("keypress", function(event) { if (event.key === "Enter") { event.preventDefault(); checkReading(); } });
    document.getElementById('g-input').addEventListener("keypress", function(event) { if (event.key === "Enter") checkGrammar(); });
    const cursor = document.getElementById('cursor'); document.addEventListener('mousemove', e => { cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; }); 
    window.onload = () => { renderMusic(); switchTab('home'); initVocabSystem(); };
</script>
</body>
</html>
