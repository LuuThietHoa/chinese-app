<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyreign Hub | V23.0 Dark Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <style>
        /* CORE SETUP */
        :root { --primary: #6366f1; --accent: #f472b6; }
        body {
            font-family: 'Space Grotesk', 'Noto Sans SC', sans-serif;
            background: linear-gradient(-45deg, #020617, #1e1b4b, #be185d, #0f766e);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            color: #fff; min-height: 100vh; overflow-x: hidden; cursor: none;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #cursor { position: fixed; width: 20px; height: 20px; background: white; border-radius: 50%; pointer-events: none; z-index: 9999; mix-blend-mode: difference; transition: transform 0.1s; }
        
        /* UI ELEMENTS */
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); transition: transform 0.3s; }
        .glass-card:hover { transform: translateY(-5px); }
        nav { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; gap: 6px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); flex-wrap: wrap; justify-content: center; width: 90%; max-width: 600px; }
        .nav-btn { padding: 10px 16px; border-radius: 18px; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; color: #94a3b8; white-space: nowrap; }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); }
        .tab-content { display: none; opacity: 0; animation: fadeIn 0.5s forwards; padding-bottom: 120px; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* EFFECTS */
        .glow-green { box-shadow: 0 0 40px #22c55e !important; border-color: #22c55e !important; }
        .glow-red { box-shadow: 0 0 40px #ef4444 !important; border-color: #ef4444 !important; }
        .mic-ripple { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); opacity: 0; animation: ripple 1.5s infinite; }
        @keyframes ripple { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(2); opacity: 0; } }
        #progress-bar { width: 0%; height: 4px; background: #22c55e; transition: width 0.1s linear; position: absolute; bottom: 0; left: 0; }
        .reading-text { line-height: 1.8; letter-spacing: 1px; text-align: justify; }
        textarea:focus { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
        @keyframes coinPop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
        .coin-pop-green { animation: coinPop 0.3s ease; color: #4ade80 !important; }
        .coin-pop-red { animation: coinPop 0.3s ease; color: #f87171 !important; }
        
        /* SHOP SPECIFIC */
        #shop-modal { transition: opacity 0.3s ease; }
        #shop-modal.hidden { display: none; }
        /* Hi·ªáu ·ª©ng bong b√≥ng chat c·ªßa NPC */
        .npc-bubble {
            position: absolute;
            background: white;
            color: black;
            padding: 15px;
            border-radius: 20px;
            border-bottom-left-radius: 0;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            font-weight: 900;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            max-width: 200px;
            border: 2px solid #6366f1;
            z-index: 50;
        }
        .song-item { display: flex; gap: 12px; padding: 10px; border-radius: 12px; background: rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; align-items: center; }
        .song-item:hover { background: rgba(255,255,255,0.15); }
        .song-item img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="cursor"></div>

<audio id="sfx-coin" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
<audio id="sfx-click" src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-click-900.mp3"></audio>
<audio id="sfx-type" src="https://assets.mixkit.co/sfx/preview/mixkit-typewriter-soft-click-1125.mp3"></audio>

<div class="fixed top-6 right-6 z-[2000] flex items-center gap-3 bg-black/40 backdrop-blur-xl px-5 py-2 rounded-full border border-yellow-500/30 shadow-2xl transition hover:scale-105">
    <div class="w-10 h-10">
        <model-viewer src="./coin.glb" alt="Coin" auto-rotate rotation-per-second="30deg" disable-zoom style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
    </div>
    <div class="flex flex-col items-end">
        <span class="text-[9px] font-bold text-yellow-500/80 uppercase tracking-widest">Balance</span>
        <span id="coin-display" class="text-2xl font-black text-yellow-400 leading-none tabular-nums">0</span>
    </div>
</div>

<div id="shop-modal" class="hidden fixed inset-0 z-[3000] bg-black/95 flex items-center justify-center p-4">
    <div class="relative w-full max-w-6xl aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl border border-white/10">
        
        <button onclick="closeShop()" class="absolute top-6 right-6 z-50 text-white hover:text-red-500 font-black text-xl bg-white/10 w-12 h-12 rounded-full flex items-center justify-center border border-white/20 transition hover:rotate-90">‚úï</button>

        <div class="absolute bottom-10 left-10 w-48 h-80 md:w-64 md:h-96 z-20">
            <model-viewer src="./main.glb" alt="Shopkeeper" auto-rotate camera-controls disable-zoom shadow-intensity="2" exposure="1.2" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
            <div class="npc-bubble -top-10 left-20">
                <p id="npc-text">...</p>
            </div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
            <div class="relative w-72 h-72 md:w-[500px] md:h-[500px] pointer-events-auto group">
                <model-viewer id="shop-mob-viewer" src="./mob1.glb" alt="Mob" auto-rotate camera-controls shadow-intensity="2" exposure="1" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
                
                <div class="absolute top-10 right-0 md:-right-20 bg-black/80 backdrop-blur-xl border border-red-500/50 p-6 rounded-2xl w-56 shadow-2xl opacity-0 group-hover:opacity-100 transition duration-300 translate-y-4 group-hover:translate-y-0">
                    <h3 class="text-red-500 font-black text-2xl mb-2 uppercase italic tracking-tighter" id="mob-name">QU√ÅI V·∫¨T 1</h3>
                    <div class="space-y-3 text-xs font-bold text-gray-400">
                        <div class="flex justify-between border-b border-white/10 pb-1"><span>‚öî T·∫•n C√¥ng:</span> <span class="text-white" id="mob-atk">200</span></div>
                        <div class="flex justify-between border-b border-white/10 pb-1"><span>‚ô• M√°u:</span> <span class="text-white" id="mob-hp">900</span></div>
                        <div class="flex justify-between pt-1 text-yellow-400 text-lg"><span>Gi√°:</span> <span>100 ü™ô</span></div>
                    </div>
                    <button class="w-full mt-4 py-3 bg-gradient-to-r from-red-600 to-red-800 text-white font-black uppercase rounded-lg hover:scale-105 transition shadow-lg shadow-red-900/50" onclick="buyItem()">MUA NGAY</button>
                </div>
            </div>
        </div>

        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-30 flex gap-4">
            <button onclick="navShop(-1)" class="px-6 py-3 bg-white/5 hover:bg-white/20 border border-white/20 rounded-xl font-bold text-xs uppercase tracking-widest text-gray-300 hover:text-white transition flex items-center gap-2">‚óÄ L√πi l·∫°i</button>
            <button onclick="navShop(1)" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 shadow-lg shadow-indigo-500/50 rounded-xl font-bold text-xs uppercase tracking-widest text-white transition flex items-center gap-2">Ti·∫øp theo ‚ñ∂</button>
        </div>
    </div>
</div>

<nav>
    <button onclick="switchTab('home')" class="nav-btn active" id="n-home">S·∫£nh</button>
    <button onclick="switchTab('vocab')" class="nav-btn" id="n-vocab">H·ªçc T·ª´</button>
    <button onclick="switchTab('reading')" class="nav-btn" id="n-reading">ƒê·ªçc Hi·ªÉu</button>
    <button onclick="switchTab('speaking')" class="nav-btn" id="n-speaking">Luy·ªán N√≥i</button>
    <button onclick="switchTab('grammar')" class="nav-btn" id="n-grammar">Ng·ªØ Ph√°p</button>
    <button onclick="switchTab('music')" class="nav-btn" id="n-music">Nh·∫°c</button>
</nav>

<div id="home" class="tab-content active">
    <div class="h-screen flex flex-col items-center justify-center relative">
        <div class="absolute top-24 left-10 cursor-pointer transition hover:scale-110 active:scale-95 group z-20" onclick="openShop()">
            <div class="w-32 h-32 relative">
                <model-viewer src="./shop.glb" alt="My Shop" auto-rotate camera-controls shadow-intensity="1" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer>
                <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-black px-3 py-1 rounded-full font-black text-[9px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition whitespace-nowrap shadow-lg border-2 border-white">C·ª≠a H√†ng</div>
            </div>
        </div>

        <div class="glass-card p-12 text-center max-w-md mx-4 z-10">
            <h1 class="text-6xl md:text-8xl font-black italic tracking-tighter mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-pink-400">SKYREIGN</h1>
            <p class="text-xs tracking-[0.5em] text-gray-400 uppercase mb-10">L∆∞u Thi·∫øt Hoa ‚Ä¢ Dark Shop v23.0</p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="switchTab('vocab')" class="py-4 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-xs uppercase tracking-widest transition">Luy·ªán T·ª´</button>
                <button onclick="switchTab('speaking')" class="py-4 bg-indigo-600 hover:bg-indigo-700 rounded-xl font-bold text-xs uppercase tracking-widest transition shadow-lg shadow-indigo-500/30">Luy·ªán N√≥i</button>
            </div>
        </div>
    </div>
</div>

<div id="reading" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-8 w-full max-w-3xl mx-4 relative" id="reading-card"> <div class="flex justify-between items-center mb-6"> <div class="text-[10px] font-black bg-pink-500 px-3 py-1 rounded-full uppercase tracking-widest">ƒêo·∫°n VƒÉn Ng·∫´u Nhi√™n</div> <button onclick="nextParagraph()" class="text-[10px] font-bold text-gray-400 hover:text-white uppercase tracking-widest transition">ƒê·ªïi b√†i kh√°c ‚Üª</button> </div> <div class="bg-black/20 p-6 rounded-2xl mb-6 border border-white/10"> <p id="r-text" class="text-xl md:text-2xl font-medium text-gray-100 reading-text">...</p> </div> <p class="text-xs text-gray-400 mb-2 italic">H√£y d·ªãch ƒëo·∫°n vƒÉn tr√™n sang Ti·∫øng Vi·ªát (+1 Coin n·∫øu ƒë√∫ng):</p> <textarea id="r-input" rows="4" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white placeholder-gray-600 outline-none focus:border-indigo-500 transition mb-6" placeholder="G√µ b·∫£n d·ªãch c·ªßa b·∫°n v√†o ƒë√¢y..."></textarea> <button onclick="checkReading()" class="w-full py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] hover:bg-indigo-400 hover:text-white transition mb-4 shadow-lg">Ki·ªÉm Tra B·∫£n D·ªãch</button> <div id="r-feedback" class="text-center min-h-[60px]"> <p id="r-msg" class="text-[11px] font-bold uppercase tracking-widest mb-1"></p> <div id="r-hint" class="text-[12px] text-green-300 hidden text-left bg-black/40 p-4 rounded-xl mt-2 border border-green-500/30"></div> </div> </div> </div> </div>
<div id="vocab" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-lg mx-4 relative" id="vocab-card"> <div class="flex justify-between items-center mb-8"> <button onclick="changeVocabMode()" id="v-mode-btn" class="text-[10px] font-black bg-pink-500 px-3 py-1 rounded-full uppercase tracking-widest hover:scale-105 transition">Mode: H√°n ‚ûî Vi·ªát</button> <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">HSK 1 FULL</div> </div> <div id="v-question" class="text-7xl font-black text-center mb-8 tracking-tighter min-h-[100px] flex items-center justify-center">?</div> <input type="text" id="v-input" placeholder="Nh·∫≠p ƒë√°p √°n..." class="w-full bg-transparent border-b-2 border-white/20 py-3 text-center font-bold text-2xl outline-none focus:border-indigo-500 transition text-white placeholder-gray-600 mb-8" autocomplete="off"> <button onclick="checkVocab()" class="w-full py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] hover:bg-gray-200 transition mb-4">Ki·ªÉm Tra</button> <div id="v-feedback" class="text-center h-10"> <p id="v-msg" class="text-[11px] font-bold uppercase tracking-widest"></p> <p id="v-hint" class="text-[10px] text-gray-400 mt-1"></p> </div> </div> </div> </div>
<div id="speaking" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-md mx-4 text-center relative overflow-hidden" id="speak-card"> <div class="text-[10px] uppercase tracking-widest text-indigo-400 font-black mb-8">V18.0 - Fast Catch</div> <div class="mb-8 relative group"> <div id="s-hz" class="text-9xl font-black mb-2 tracking-tighter cursor-pointer transition hover:text-indigo-400" onclick="speakText(document.getElementById('s-hz').innerText)">Êàë</div> <div id="s-py" class="text-2xl text-gray-500 mb-1">w«í</div> <div id="s-mn" class="text-xs font-bold bg-white/10 px-3 py-1 rounded-full inline-block">T√îI</div> </div> <div class="flex justify-center items-center gap-6 mb-8"> <button onclick="changeSpeakWord(-1)" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition">‚Üê</button> <div class="relative"> <div id="mic-ring" class="hidden mic-ripple"></div> <button id="mic-btn" class="w-20 h-20 bg-indigo-600 rounded-full flex items-center justify-center shadow-2xl relative z-10 transition hover:scale-110 active:scale-90 text-white"> <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg> </button> </div> <button onclick="changeSpeakWord(1)" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/20 flex items-center justify-center transition">‚Üí</button> </div> <div id="s-feedback" class="text-[11px] font-bold uppercase tracking-widest text-gray-400 h-16 flex flex-col items-center justify-center px-4"> <span id="s-status">B·∫•m mic v√† n√≥i ngay</span> <span id="s-sub" class="text-[9px] text-gray-500 mt-1"></span> </div> <div id="s-live-text" class="absolute bottom-1 w-full text-center text-[9px] text-indigo-300/50 uppercase tracking-widest"></div> <div id="progress-bar"></div> </div> </div> </div>
<div id="grammar" class="tab-content"> <div class="min-h-screen flex items-center justify-center pt-20"> <div class="glass-card p-10 w-full max-w-2xl mx-4 relative overflow-hidden" id="grammar-card"> <div class="flex justify-between items-center mb-10"> <button onclick="toggleGrammarMode()" id="g-mode-badge" class="text-[10px] font-black bg-indigo-600 px-3 py-1 rounded-full uppercase tracking-widest hover:scale-110 transition shadow-lg shadow-indigo-500/50">Trung ‚ûî Vi·ªát</button> <div class="text-[9px] font-bold text-gray-400">HSK1 GRAMMAR</div> </div> <div class="text-center mb-10 min-h-[120px] flex flex-col justify-center items-center"> <div id="g-question" class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight drop-shadow-lg cursor-pointer hover:text-indigo-300 transition" onclick="readGrammarQuestion()">...</div> <p id="g-instruction" class="text-gray-500 text-sm italic">H√£y d·ªãch c√¢u tr√™n</p> </div> <input type="text" id="g-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." class="w-full bg-transparent border-b-2 border-white/10 py-4 text-center text-xl font-medium outline-none focus:border-indigo-500 transition mb-6 text-white placeholder-gray-600" autocomplete="off"> <div class="grid grid-cols-4 gap-4 mb-6"> <button onclick="nextGrammar()" class="col-span-1 py-4 bg-white/5 hover:bg-white/10 rounded-2xl font-bold text-[10px] uppercase tracking-widest text-gray-400 hover:text-white transition">B·ªè qua</button> <button onclick="checkGrammar()" class="col-span-3 py-4 bg-white text-black hover:bg-indigo-400 hover:text-white rounded-2xl font-black text-xs uppercase tracking-[0.2em] transition shadow-lg">Ki·ªÉm tra</button> </div> <div id="g-feedback" class="text-center h-20"> <div id="g-msg" class="text-[11px] font-bold uppercase tracking-widest mb-1"></div> <div id="g-note" class="text-[11px] text-pink-400 font-medium"></div> </div> </div> </div> </div>
<div id="music" class="tab-content"> <div class="min-h-screen flex flex-col items-center justify-center pt-20 pb-20"> <div class="flex flex-col md:flex-row items-center justify-center gap-8 w-full max-w-6xl px-4"> <div class="glass-card p-6 w-full md:w-72 h-96 overflow-y-auto"> <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-indigo-400 border-b border-white/10 pb-2">V-Pop Hits</h3> <div id="v-list" class="space-y-2"></div> </div> <div class="w-full max-w-md flex flex-col items-center"> <h4 class="text-4xl font-black text-white tracking-tighter uppercase mb-4 drop-shadow-lg">Music Pod</h4> <div class="relative w-full h-[300px]"> <model-viewer src="./airpods.glb" alt="My Airpods" auto-rotate camera-controls shadow-intensity="1" exposure="0.8" style="width: 100%; height: 100%; --poster-color: transparent;"></model-viewer> </div> <div class="w-full aspect-video bg-black rounded-2xl overflow-hidden border-2 border-white/20 shadow-2xl mt-[-40px] relative z-10"> <div id="player" class="w-full h-full"></div> <video id="mp4-player" controls playsinline class="hidden w-full h-full object-cover"></video> <div id="video-error" class="hidden absolute inset-0 bg-black/80 flex items-center justify-center text-center p-4"> <p class="text-red-500 font-bold text-xs uppercase tracking-widest">Link nh·∫°c h·ªèng!<br>Vui l√≤ng c·∫≠p nh·∫≠t link MP4 m·ªõi.</p> </div> </div> </div> <div class="glass-card p-6 w-full md:w-72 h-96 overflow-y-auto"> <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-pink-400 border-b border-white/10 pb-2">Chinese Hits</h3> <div id="c-list" class="space-y-2"></div> </div> </div> </div> </div>

<script>
    // --- COIN & SHOP SYSTEM ---
    let userCoins = parseInt(localStorage.getItem('skyCoins')) || 0;
    const coinDisplay = document.getElementById('coin-display');
    const coinSfx = document.getElementById('sfx-coin');
    const clickSfx = document.getElementById('sfx-click');
    const typeSfx = document.getElementById('sfx-type');
    coinDisplay.innerText = userCoins;

    function updateCoins(amount) {
        userCoins += amount;
        localStorage.setItem('skyCoins', userCoins);
        coinDisplay.innerText = userCoins;
        coinDisplay.classList.remove('coin-pop-green', 'coin-pop-red');
        void coinDisplay.offsetWidth;
        if(amount > 0) { coinDisplay.classList.add('coin-pop-green'); coinSfx.currentTime = 0; coinSfx.play().catch(e=>{}); } 
        else { coinDisplay.classList.add('coin-pop-red'); }
    }

    // --- SHOP LOGIC (DARK MODE) ---
    const mobs = [ 
        { id: "mob1", model: "./mob1.glb", name: "Qu√°i V·∫≠t 1", atk: 200, hp: 900, price: 100 }
        // Sau n√†y th√™m mob2, mob3 v√†o ƒë√¢y
    ];
    let shopIdx = 0;

    function openShop() { 
        clickSfx.currentTime = 0; clickSfx.play().catch(e=>{}); 
        document.getElementById('shop-modal').classList.remove('hidden'); 
        setTimeout(() => typeWriter("H√£y mua nh·ªØng g√¨ b·∫°n mu·ªën...", "npc-text"), 500); 
        loadMob(0); 
    }
    
    function closeShop() { document.getElementById('shop-modal').classList.add('hidden'); }
    
    function loadMob(idx) { 
        if(idx < 0 || idx >= mobs.length) { alert("H√£y ƒë·ª£i c·∫≠p nh·∫≠t th√™m qu√°i m·ªõi!"); return; } 
        shopIdx = idx; 
        const m = mobs[shopIdx]; 
        document.getElementById('shop-mob-viewer').src = m.model; 
        document.getElementById('mob-name').innerText = m.name; 
        document.getElementById('mob-atk').innerText = m.atk; 
        document.getElementById('mob-hp').innerText = m.hp; 
    }
    
    function navShop(dir) { loadMob(shopIdx + dir); }
    
    function buyItem() { 
        if(userCoins >= mobs[shopIdx].price) { 
            updateCoins(-mobs[shopIdx].price); 
            alert("Mua th√†nh c√¥ng!"); 
        } else { 
            alert("B·∫°n kh√¥ng ƒë·ªß ti·ªÅn!"); 
        } 
    }
    
    function typeWriter(text, elementId) { 
        const el = document.getElementById(elementId); 
        el.innerText = ""; 
        let i = 0; 
        const speed = 50; 
        function typing() { 
            if (i < text.length) { 
                el.innerText += text.charAt(i); 
                typeSfx.currentTime = 0; typeSfx.play().catch(e=>{}); 
                i++; 
                setTimeout(typing, speed); 
            } 
        } 
        typing(); 
    }

    // --- SYSTEM CORE ---
    function speakText(text) { if(!text) return; window.speechSynthesis.cancel(); const msg = new SpeechSynthesisUtterance(text); msg.lang = 'zh-CN'; msg.rate = 0.8; window.speechSynthesis.speak(msg); }
    const homophones = { "‰ªñ": ["Â•π", "ÂÆÉ"], "ÂÅö": ["‰Ωú", "Â∫ß", "Âùê"], "ÈÇ£": ["Âì™"], "ÊòØ": ["‰∫ã", "Â∏Ç", "ËØï"], "‰∏Ä": ["Ë°£", "Âåª"], "Êúâ": ["Âèã", "Âèà"] };
    
    // --- MUSIC LOGIC ---
    const vPop = [
        {name: "H√¥n v√†o ƒë√¢y (MP4)", type: "mp4", id: "https://files.catbox.moe/kos9gw.mp4", thumb: "https://img.youtube.com/vi/vs-hsW6I63I/mqdefault.jpg"},
        {name: "H√† N·ªôi (MP4)", type: "mp4", id: "https://files.catbox.moe/1ygyge.mp4", thumb: "https://img.youtube.com/vi/OerAX-zKyvg/mqdefault.jpg"}
    ];
    const cPop = [
        {name: "S·ª© Thanh Hoa", type: "yt", id: "Z7vlR53_qNM", thumb: "https://img.youtube.com/vi/Z7vlR53_qNM/mqdefault.jpg"},
        {name: "ƒê√°y Bi·ªÉn", type: "yt", id: "rJjQ4w-B3cE", thumb: "https://img.youtube.com/vi/rJjQ4w-B3cE/mqdefault.jpg"}
    ];
    var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; var firstScriptTag = document.getElementsByTagName('script')[0]; firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var player; function onYouTubeIframeAPIReady() { player = new YT.Player('player', { height: '100%', width: '100%', videoId: '' }); }
    function playMedia(source, type) { const ytDiv = document.getElementById('player'); const mp4Div = document.getElementById('mp4-player'); const errDiv = document.getElementById('video-error'); errDiv.classList.add('hidden'); if(player && typeof player.stopVideo === 'function') player.stopVideo(); mp4Div.pause(); if (type === 'mp4') { ytDiv.style.display = 'none'; mp4Div.style.display = 'block'; mp4Div.src = source; mp4Div.load(); mp4Div.onerror = function() { errDiv.classList.remove('hidden'); mp4Div.style.display = 'none'; }; var playPromise = mp4Div.play(); if (playPromise !== undefined) { playPromise.catch(error => { console.log("Auto-play blocked"); }); } } else { mp4Div.style.display = 'none'; ytDiv.style.display = 'block'; if(player && typeof player.loadVideoById === 'function') { player.loadVideoById(source); } } }
    function renderMusic() { const tpl = (s) => `<div class="song-item" onclick="playMedia('${s.id}', '${s.type}')"><img src="${s.thumb}"><div><h4 class="text-[10px] font-bold uppercase">${s.name}</h4><p class="text-[9px] text-gray-400">${s.type === 'mp4' ? 'NO ADS' : 'Youtube'}</p></div></div>`; document.getElementById('v-list').innerHTML = vPop.map(tpl).join(''); document.getElementById('c-list').innerHTML = cPop.map(tpl).join(''); }

    // --- (RE-PASTED LOGIC FROM PREVIOUS VERSIONS) ---
    const vocabData = [{hz:"Êàë",py:"w«í",mn:"t√¥i"},{hz:"‰Ω†",py:"n«ê",mn:"b·∫°n"},{hz:"‰ªñ",py:"tƒÅ",mn:"anh ·∫•y"},{hz:"Â•π",py:"tƒÅ",mn:"c√¥ ·∫•y"},{hz:"Êàë‰ª¨",py:"w«ímen",mn:"ch√∫ng t√¥i"},{hz:"Ë∞Å",py:"sh√©i",mn:"ai"},{hz:"Áà∏Áà∏",py:"b√†ba",mn:"b·ªë"},{hz:"Â¶àÂ¶à",py:"mƒÅma",mn:"m·∫π"},{hz:"ÂÑøÂ≠ê",py:"√©rzi",mn:"con trai"},{hz:"Â•≥ÂÑø",py:"n«ö√©r",mn:"con g√°i"},{hz:"ËÄÅÂ∏à",py:"l«éoshƒ´",mn:"th·∫ßy c√¥"},{hz:"Â≠¶Áîü",py:"xu√©sheng",mn:"h·ªçc sinh"},{hz:"ÂêåÂ≠¶",py:"t√≥ngxu√©",mn:"b·∫°n h·ªçc"},{hz:"ÊúãÂèã",py:"p√©ngyou",mn:"b·∫°n b√®"},{hz:"‰∫∫",py:"r√©n",mn:"ng∆∞·ªùi"},{hz:"ÂÖàÁîü",py:"xiƒÅnsheng",mn:"ng√†i/√¥ng"},{hz:"Â∞èÂßê",py:"xi«éojiƒõ",mn:"c√¥/ch·ªã"},{hz:"Èõ∂",py:"l√≠ng",mn:"kh√¥ng"},{hz:"‰∏Ä",py:"yƒ´",mn:"m·ªôt"},{hz:"‰∫å",py:"√®r",mn:"hai"},{hz:"‰∏â",py:"sƒÅn",mn:"ba"},{hz:"Âõõ",py:"s√¨",mn:"b·ªën"},{hz:"‰∫î",py:"w«î",mn:"nƒÉm"},{hz:"ÂÖ≠",py:"li√π",mn:"s√°u"},{hz:"‰∏É",py:"qƒ´",mn:"b·∫£y"},{hz:"ÂÖ´",py:"bƒÅ",mn:"t√°m"},{hz:"‰πù",py:"ji«î",mn:"ch√≠n"},{hz:"ÂçÅ",py:"sh√≠",mn:"m∆∞·ªùi"}]; 
    const grammarBank = [{zh:"ÊàëÊòØÂ≠¶Áîü„ÄÇ",vi:"t√¥i l√† h·ªçc sinh",note:"C√¢u ch·ªØ ÊòØ"},{zh:"ËøôÊòØ‰ªÄ‰πàÔºü",vi:"ƒë√¢y l√† c√°i g√¨",note:"H·ªèi c√°i g√¨"}];
    const readingData = [{id:1,zh:"‰Ω†Â•ΩÔºÅÊàëÂè´ÂàòÈìÅËä±...",key:"xin ch√†o t√¥i t√™n l∆∞u thi·∫øt hoa..."}];
    let vMode=0; let vIdx=0; let sIdx=0; let gIdx=0; let gMode=0; let rIdx=0;
    function switchTab(id) { document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); document.getElementById(id).classList.add('active'); document.getElementById('n-'+id).classList.add('active'); if(id==='vocab')nextVocab(false); if(id==='speaking')updateSpeakUI(); if(id==='grammar')nextGrammar(); if(id==='reading')nextParagraph(); }
    function nextParagraph(){let newIdx;do{newIdx=Math.floor(Math.random()*readingData.length);}while(newIdx===rIdx&&readingData.length>1);rIdx=newIdx;const item=readingData[rIdx];document.getElementById('r-text').innerText=item.zh;document.getElementById('r-input').value="";document.getElementById('r-msg').innerText="";document.getElementById('r-hint').innerText="";document.getElementById('r-hint').classList.add('hidden');document.getElementById('reading-card').className="glass-card p-8 w-full max-w-3xl mx-4 relative";}
    function checkReading(){const input=document.getElementById('r-input').value.trim().toLowerCase();const target=readingData[rIdx].key;const card=document.getElementById('reading-card');const hint=document.getElementById('r-hint');const inputWords=input.split(/\s+/);const targetWords=target.split(/\s+/);let matchCount=0;inputWords.forEach(word=>{if(target.includes(word))matchCount++;});const score=matchCount/targetWords.length;if(score>0.5){updateCoins(1);document.getElementById('r-msg').innerText=`R·∫§T T·ªêT! (${Math.round(score*100)}%)`;document.getElementById('r-msg').style.color="#4ade80";card.classList.add('glow-green');hint.classList.add('hidden');}else{updateCoins(-1);document.getElementById('r-msg').innerText=`CH∆ØA ƒê·∫†T (${Math.round(score*100)}%)`;document.getElementById('r-msg').style.color="#f87171";card.classList.add('glow-red');hint.innerHTML=`<strong class="text-white">THAM KH·∫¢O:</strong><br>${target}`;hint.classList.remove('hidden');}}
    function changeVocabMode(){vMode=(vMode+1)%3;const labels=["H√°n ‚ûî Vi·ªát","Vi·ªát ‚ûî H√°n","H√°n ‚ûî Pinyin"];document.getElementById('v-mode-btn').innerText="Mode: "+labels[vMode];nextVocab(false);}
    function nextVocab(random=true){if(random)vIdx=Math.floor(Math.random()*vocabData.length);const item=vocabData[vIdx];document.getElementById('v-question').innerText=vMode===0?item.hz:(vMode===1?item.mn.toUpperCase():item.hz);document.getElementById('v-input').value="";document.getElementById('v-msg').innerText="";document.getElementById('vocab-card').classList.remove('glow-green','glow-red');}
    function checkVocab(){const item=vocabData[vIdx];const val=document.getElementById('v-input').value.trim().toLowerCase();let correct=false;if(vMode===0)correct=val===item.mn.toLowerCase();else if(vMode===1)correct=val===item.hz;else correct=val===item.py.toLowerCase()||val===item.py.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(correct){updateCoins(1);document.getElementById('v-msg').innerText="CH√çNH X√ÅC!";document.getElementById('vocab-card').classList.add('glow-green');speakText(item.hz);setTimeout(()=>nextVocab(true),1200);}else{updateCoins(-1);document.getElementById('v-msg').innerText="SAI R·ªíI";document.getElementById('vocab-card').classList.add('glow-red');speakText(item.hz);}}
    function updateSpeakUI(){const item=vocabData[sIdx];document.getElementById('s-hz').innerText=item.hz;document.getElementById('s-py').innerText=item.py;document.getElementById('s-mn').innerText=item.mn.toUpperCase();document.getElementById('speak-card').classList.remove('glow-green','glow-red');document.getElementById('s-status').innerText="B·∫•m mic v√† n√≥i ngay";document.getElementById('s-live-text').innerText="";}
    function changeSpeakWord(dir){sIdx=(sIdx+dir+vocabData.length)%vocabData.length;updateSpeakUI();}
    const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;let recognition;let timer;
    if(SpeechRecognition){recognition=new SpeechRecognition();recognition.lang='zh-CN';recognition.interimResults=true;recognition.continuous=true;const btn=document.getElementById('mic-btn');const status=document.getElementById('s-status');const progressBar=document.getElementById('progress-bar');const card=document.getElementById('speak-card');const liveText=document.getElementById('s-live-text');let isListening=false;btn.onclick=()=>{if(isListening)return;startSession();};function startSession(){isListening=true;card.classList.remove('glow-green','glow-red');status.innerText="ƒêANG NGHE...";progressBar.style.width='100%';progressBar.style.transition="width 5s linear";try{recognition.start();}catch(e){}timer=setTimeout(()=>{finishSession("TIMEOUT");},5000);}recognition.onresult=(e)=>{let interim="";for(let i=e.resultIndex;i<e.results.length;++i){interim+=e.results[i][0].transcript;}liveText.innerText="Nghe: "+interim;const target=vocabData[sIdx].hz;const clean=interim.replace(/[.,?„ÄÇÔºü!ÔºÅ]/g,"");if(clean.includes(target)||(homophones[target]&&homophones[target].some(h=>clean.includes(h)))){finishSession("WIN",clean);}};recognition.onerror=()=>{finishSession("ERROR");};recognition.onend=()=>{if(isListening){try{recognition.start()}catch(e){}}};function finishSession(type,word=""){if(!isListening)return;isListening=false;clearTimeout(timer);recognition.stop();progressBar.style.transition="none";progressBar.style.width='0%';if(type==="WIN"){status.innerText="CH√çNH X√ÅC!";card.classList.add('glow-green');}else{status.innerText="TH·ª¨ L·∫†I";card.classList.add('glow-red');}}}
    function toggleGrammarMode(){gMode=1-gMode;document.getElementById('g-mode-badge').innerText=gMode===0?"Trung ‚ûî Vi·ªát":"Vi·ªát ‚ûî Trung";nextGrammar();}
    function nextGrammar(){let newIdx;do{newIdx=Math.floor(Math.random()*grammarBank.length);}while(newIdx===gIdx&&grammarBank.length>1);gIdx=newIdx;const item=grammarBank[gIdx];document.getElementById('g-question').innerText=gMode===0?item.zh:item.vi.toUpperCase();document.getElementById('g-instruction').innerText=gMode===0?"D·ªãch c√¢u n√†y sang Ti·∫øng Vi·ªát" : "D·ªãch c√¢u n√†y sang Ti·∫øng Trung"; document.getElementById('g-input').value = ""; document.getElementById('g-msg').innerText = ""; document.getElementById('g-note').innerText = ""; document.getElementById('grammar-card').className="glass-card p-10 w-full max-w-2xl mx-4 relative overflow-hidden"; if(gMode===0)speakText(item.zh);}
    function checkGrammar(){const val=document.getElementById('g-input').value.trim().toLowerCase();const item=grammarBank[gIdx];const target=gMode===0?item.vi:item.zh;const card=document.getElementById('grammar-card');let isCorrect=false;if(gMode===0)isCorrect=val===target.toLowerCase()||(target.toLowerCase().includes(val)&&val.length>5);else isCorrect=val===target||val===target.replace(/Ôºü|„ÄÇ/g,"");speakText(item.zh);if(isCorrect){updateCoins(1);document.getElementById('g-msg').innerText="R·∫§T T·ªêT!";card.classList.add('glow-green');setTimeout(nextGrammar,2000);}else{updateCoins(-1);document.getElementById('g-msg').innerText="CH∆ØA CH√çNH X√ÅC";card.classList.add('glow-red');}}

    const cursor = document.getElementById('cursor'); document.addEventListener('mousemove', e => { cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; }); function handleGlobalClick() { cursor.style.transform = "scale(2)"; setTimeout(() => cursor.style.transform = "scale(1)", 150); }
    window.onload = () => { renderMusic(); switchTab('home'); };
</script>
</body>
</html>
