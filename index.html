<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyreign Hub | V31.0 Focus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* CORE SETUP */
        :root { --primary: #6366f1; --accent: #f472b6; --glass: rgba(255, 255, 255, 0.05); }
        body {
            font-family: 'Space Grotesk', 'Noto Sans SC', sans-serif;
            background: linear-gradient(-45deg, #0f172a, #312e81, #831843, #115e59);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            color: #fff; min-height: 100vh; overflow-x: hidden;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* UI ELEMENTS */
        .glass-card { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        /* NAVIGATION */
        nav { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000; display: flex; background: rgba(0,0,0,0.9); padding: 15px; backdrop-filter: blur(10px); border-top: 1px solid rgba(255,255,255,0.1); overflow-x: auto; justify-content: center; gap: 10px; }
        .nav-btn { padding: 8px 16px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; color: #94a3b8; white-space: nowrap; background: rgba(255,255,255,0.05); }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }
        
        .tab-content { display: none; padding-bottom: 100px; animation: fadeIn 0.3s forwards; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* EFFECTS */
        .glow-green { border-color: #22c55e !important; box-shadow: 0 0 20px #22c55e !important; }
        .glow-red { border-color: #ef4444 !important; box-shadow: 0 0 20px #ef4444 !important; }
        .reading-text { line-height: 2; letter-spacing: 1px; text-align: justify; font-size: 1.2rem; }
        input, textarea { background: rgba(0,0,0,0.3) !important; color: white !important; }

        /* SCHEDULE TABLE */
        .schedule-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        .schedule-table th { background: rgba(99, 102, 241, 0.3); padding: 12px; text-transform: uppercase; color: white; border: 1px solid rgba(255,255,255,0.2); }
        .schedule-table td { padding: 12px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .time-chip { display: inline-block; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 6px 12px; margin: 4px; border-radius: 20px; font-size: 10px; cursor: pointer; transition: 0.2s; }
        .time-chip:hover { background: var(--primary); border-color: var(--primary); }
        
        .song-item { display: flex; gap: 12px; padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; align-items: center; border: 1px solid transparent; }
        .song-item:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.2); }
        .song-item img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body>

<div class="fixed top-0 left-0 w-full p-4 flex justify-between items-center z-50 bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
    <div class="pointer-events-auto">
        <h1 class="text-xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-pink-400">SKYREIGN <span class="text-[10px] text-gray-400 not-italic">V31.0</span></h1>
    </div>
    <div class="pointer-events-auto flex items-center gap-3 bg-black/40 backdrop-blur px-4 py-2 rounded-full border border-yellow-500/30">
        <span class="text-2xl">ü™ô</span>
        <span id="coin-display" class="text-xl font-black text-yellow-400 tabular-nums">0</span>
    </div>
</div>

<nav>
    <button onclick="switchTab('home')" class="nav-btn active" id="n-home">üè† Home</button>
    <button onclick="switchTab('memo')" class="nav-btn" id="n-memo">üìö Ghi Nh·ªõ</button>
    <button onclick="switchTab('test')" class="nav-btn" id="n-test">‚úçÔ∏è Ki·ªÉm Tra</button>
    <button onclick="switchTab('work')" class="nav-btn" id="n-work">üìÖ L·ªãch L√†m</button>
    <button onclick="switchTab('vocab')" class="nav-btn" id="n-vocab">üî§ H·ªçc T·ª´</button>
    <button onclick="switchTab('reading')" class="nav-btn" id="n-reading">üìñ ƒê·ªçc</button>
    <button onclick="switchTab('music')" class="nav-btn" id="n-music">üéµ Nh·∫°c</button>
</nav>

<div id="home" class="tab-content active">
    <div class="min-h-screen flex flex-col items-center justify-center p-4">
        <div class="glass-card p-10 text-center max-w-md w-full">
            <h2 class="text-3xl font-bold mb-2">Ch√†o Thi·∫øt Hoa!</h2>
            <p class="text-gray-400 mb-8 text-sm">H√¥m nay b·∫°n mu·ªën l√†m g√¨?</p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="switchTab('work')" class="p-6 bg-indigo-600/20 hover:bg-indigo-600 border border-indigo-500/50 rounded-xl transition group">
                    <div class="text-3xl mb-2">üìÖ</div>
                    <div class="font-bold text-xs uppercase tracking-widest">X·∫øp L·ªãch</div>
                </button>
                <button onclick="switchTab('memo')" class="p-6 bg-pink-600/20 hover:bg-pink-600 border border-pink-500/50 rounded-xl transition group">
                    <div class="text-3xl mb-2">üß†</div>
                    <div class="font-bold text-xs uppercase tracking-widest">√în Ng·ªØ Ph√°p</div>
                </button>
                <button onclick="switchTab('vocab')" class="p-6 bg-green-600/20 hover:bg-green-600 border border-green-500/50 rounded-xl transition group">
                    <div class="text-3xl mb-2">üî§</div>
                    <div class="font-bold text-xs uppercase tracking-widest">H·ªçc T·ª´ V·ª±ng</div>
                </button>
                <button onclick="switchTab('music')" class="p-6 bg-orange-600/20 hover:bg-orange-600 border border-orange-500/50 rounded-xl transition group">
                    <div class="text-3xl mb-2">üéß</div>
                    <div class="font-bold text-xs uppercase tracking-widest">Nghe Nh·∫°c</div>
                </button>
            </div>
        </div>
    </div>
</div>

<div id="memo" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4">
        <h2 class="text-2xl font-black uppercase mb-6 tracking-widest text-indigo-400">Danh S√°ch Ng·ªØ Ph√°p</h2>
        <div id="grammar-list" class="w-full max-w-3xl space-y-4">
            </div>
    </div>
</div>

<div id="test" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4">
        <div class="glass-card p-8 w-full max-w-3xl relative">
            <div class="flex justify-center gap-4 mb-8">
                <button onclick="setTestMode('analyze')" class="px-4 py-2 bg-indigo-600 rounded-lg text-xs font-bold uppercase hover:bg-indigo-500 shadow-lg">Ph√¢n T√≠ch & ƒê·∫∑t C√¢u</button>
                <button onclick="setTestMode('fill')" class="px-4 py-2 bg-pink-600 rounded-lg text-xs font-bold uppercase hover:bg-pink-500 shadow-lg">ƒêi·ªÅn T·ª´ (H·ªôi tho·∫°i)</button>
            </div>

            <div id="test-analyze" class="hidden">
                <div class="text-center mb-6 bg-black/30 p-6 rounded-xl border border-white/10">
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-2">AI H·ªèi B·∫°n:</p>
                    <h3 id="ta-question" class="text-4xl font-black text-white mb-2">...</h3>
                </div>
                
                <p id="ta-status" class="text-center text-sm font-bold h-6 mb-4"></p>

                <div id="ta-step1" class="space-y-3">
                    <p class="text-sm text-center text-gray-400 italic">C√¢u tr√™n thu·ªôc ng·ªØ ph√°p n√†o?</p>
                    <div class="grid grid-cols-1 gap-3" id="ta-options"></div>
                </div>

                <div id="ta-step2" class="hidden space-y-4 animate-fadeIn">
                    <div class="bg-indigo-900/30 p-4 rounded-xl border border-indigo-500/30">
                        <p class="text-sm font-bold text-indigo-300 mb-2">Ph√¢n t√≠ch th√†nh ph·∫ßn c√¢u:</p>
                        <div class="space-y-3">
                            <div>
                                <label class="text-[10px] uppercase text-gray-400">Ch·ªß ng·ªØ (S) l√† g√¨?</label>
                                <input type="text" id="ta-sub-input" class="w-full p-2 rounded border border-white/20 outline-none focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400">Danh t·ª´ (N) l√† g√¨?</label>
                                <input type="text" id="ta-noun-input" class="w-full p-2 rounded border border-white/20 outline-none focus:border-indigo-500">
                            </div>
                            <button onclick="checkComponents()" class="w-full py-3 bg-white text-black font-bold text-xs uppercase rounded hover:bg-gray-200">Ki·ªÉm Tra Th√†nh Ph·∫ßn</button>
                        </div>
                    </div>
                </div>

                <div id="ta-step3" class="hidden space-y-4 animate-fadeIn mt-4">
                    <div class="bg-green-900/30 p-4 rounded-xl border border-green-500/30">
                        <p class="text-sm font-bold text-green-400 mb-2">Th·ª≠ th√°ch: T·ª± ƒë·∫∑t 1 c√¢u t∆∞∆°ng t·ª±</p>
                        <input type="text" id="ta-make-sentence" class="w-full p-3 rounded border border-white/20 outline-none focus:border-green-500 text-center text-xl" placeholder="Nh·∫≠p c√¢u ti·∫øng Trung...">
                        <button onclick="checkAISentence()" class="w-full mt-3 py-3 bg-green-600 text-white font-bold text-xs uppercase rounded hover:bg-green-500">AI Ki·ªÉm Tra (+Ti·ªÅn)</button>
                        <div id="ta-ai-feedback" class="text-center text-xs font-bold mt-2"></div>
                    </div>
                </div>
            </div>

            <div id="test-fill" class="hidden flex flex-col items-center">
                 <div class="bg-black/30 p-8 rounded-2xl w-full mb-6 border border-white/10 min-h-[100px] flex items-center justify-center">
                    <p id="tf-dialogue" class="text-2xl leading-relaxed text-center font-medium"></p>
                 </div>
                 <div id="tf-options" class="flex flex-wrap gap-3 justify-center mb-6"></div>
                 <p id="tf-msg" class="text-xs font-bold uppercase tracking-widest h-6 mb-4"></p>
                 <button onclick="nextFillTest()" class="py-2 px-6 bg-white/10 rounded-full text-[10px] uppercase hover:bg-white/20">ƒê·ªïi ƒëo·∫°n kh√°c</button>
            </div>
        </div>
    </div>
</div>

<div id="work" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4">
        <div class="glass-card p-8 w-full max-w-4xl">
            <h2 class="text-2xl font-black uppercase text-center mb-6 text-orange-400">X·∫øp L·ªãch T·ª± ƒê·ªông</h2>
            
            <div id="work-wizard" class="flex flex-col items-center">
                <div class="w-full max-w-md space-y-6">
                    <div class="text-center">
                        <span class="text-[10px] bg-white/10 px-3 py-1 rounded-full uppercase text-gray-400">B∆∞·ªõc <span id="w-step-num">1</span>/7</span>
                        <h3 class="text-3xl font-bold mt-2 text-white" id="w-day-title">Th·ª© 2</h3>
                    </div>
                    
                    <div id="w-date-input-container">
                        <label class="text-[10px] uppercase font-bold text-gray-500">Ng√†y</label>
                        <input type="text" id="w-date" class="w-full bg-transparent border-b border-white/20 py-2 text-xl outline-none focus:border-orange-500" placeholder="V√≠ d·ª•: 15/10">
                    </div>

                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500">V·ªã tr√≠</label>
                        <input type="text" id="w-pos" class="w-full bg-transparent border-b border-white/20 py-2 text-xl outline-none focus:border-orange-500" placeholder="Nh·∫≠p v·ªã tr√≠...">
                        <div class="mt-2">
                             <span onclick="setVal('w-pos','Donut')" class="time-chip">Donut</span>
                             <span onclick="setVal('w-pos','N√∫i L·ª≠a')" class="time-chip">N√∫i L·ª≠a</span>
                             <span onclick="setVal('w-pos','C·ªïng')" class="time-chip">C·ªïng</span>
                             <span onclick="setVal('w-pos','OFF')" class="time-chip text-red-400 border-red-400">NGH·ªà</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500">Ca l√†m vi·ªác</label>
                        <input type="text" id="w-time" class="w-full bg-transparent border-b border-white/20 py-2 text-xl outline-none focus:border-orange-500" placeholder="Nh·∫≠p gi·ªù...">
                        <div class="mt-2">
                            <span onclick="setVal('w-time','15h30-22h30')" class="time-chip">15h30-22h30</span>
                            <span onclick="setVal('w-time','18h00-22h30')" class="time-chip">18h00-22h30</span>
                            <span onclick="setVal('w-time','08h30-15h30')" class="time-chip">08h30-15h30</span>
                        </div>
                    </div>

                    <button onclick="nextWorkStep()" class="w-full py-4 bg-orange-600 rounded-xl font-bold uppercase tracking-widest shadow-lg active:scale-95 transition hover:bg-orange-500">Ti·∫øp Theo ‚ûî</button>
                </div>
            </div>

            <div id="work-result" class="hidden">
                <div class="overflow-x-auto rounded-xl border border-white/10">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Th·ª©</th>
                                <th>Ng√†y</th>
                                <th>V·ªã Tr√≠</th>
                                <th>Gi·ªù L√†m</th>
                                <th>Gi·ªù C√¥ng</th>
                            </tr>
                        </thead>
                        <tbody id="work-tbody"></tbody>
                    </table>
                </div>
                <div class="mt-6 flex gap-4 justify-center">
                    <button onclick="resetWorkSchedule()" class="px-6 py-3 bg-gray-700 rounded-lg text-xs font-bold uppercase hover:bg-gray-600">L√†m L·∫°i</button>
                    <button onclick="window.print()" class="px-6 py-3 bg-white text-black rounded-lg text-xs font-bold uppercase hover:bg-gray-200">In L·ªãch</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="vocab" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4">
        <div class="glass-card p-10 w-full max-w-lg relative text-center" id="vocab-card">
            <div class="flex justify-between items-center mb-8">
                <button onclick="changeVocabMode()" id="v-mode-btn" class="text-[10px] font-black bg-pink-500 px-3 py-1 rounded-full uppercase tracking-widest hover:scale-105 transition">Mode: H√°n ‚ûî Vi·ªát</button>
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">HSK 1</div>
            </div>
            <div id="v-question" class="text-6xl md:text-7xl font-black text-center mb-8 tracking-tighter min-h-[80px] flex items-center justify-center">...</div>
            
            <input type="text" id="v-input" placeholder="Nh·∫≠p ƒë√°p √°n..." class="w-full bg-transparent border-b-2 border-white/20 py-3 text-center font-bold text-2xl outline-none focus:border-indigo-500 transition text-white placeholder-gray-600 mb-8" autocomplete="off" onkeypress="if(event.key==='Enter') checkVocab()">
            
            <button onclick="checkVocab()" class="w-full py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] hover:bg-gray-200 transition mb-4">Ki·ªÉm Tra</button>
            
            <div id="v-feedback" class="text-center h-12">
                <p id="v-msg" class="text-[11px] font-bold uppercase tracking-widest"></p>
                <p id="v-hint" class="text-[14px] font-bold text-red-400 mt-1 uppercase hidden"></p>
            </div>
        </div>
    </div>
</div>

<div id="reading" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4">
        <div class="glass-card p-8 w-full max-w-3xl relative" id="reading-card">
            <div class="flex justify-between items-center mb-6">
                <div class="text-[10px] font-black bg-green-500 px-3 py-1 rounded-full uppercase tracking-widest">ƒêo·∫°n VƒÉn</div>
                <div class="flex gap-2">
                    <button id="r-toggle-btn" onclick="toggleReadingRef()" class="text-[10px] font-bold text-indigo-300 hover:text-white uppercase tracking-widest transition border border-indigo-500 px-2 py-1 rounded-lg">Xem ƒê√°p √Ån</button>
                    <button onclick="nextParagraph()" class="text-[10px] font-bold text-gray-400 hover:text-white uppercase tracking-widest transition">B√†i Kh√°c ‚Üª</button>
                </div>
            </div>
            <div class="bg-black/20 p-6 rounded-2xl mb-6 border border-white/10 h-64 overflow-y-auto">
                <p id="r-text" class="reading-text text-gray-100">ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>
            <textarea id="r-input" rows="3" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white placeholder-gray-600 outline-none focus:border-indigo-500 transition mb-4" placeholder="D·ªãch sang Ti·∫øng Vi·ªát..."></textarea>
            <button onclick="checkReading()" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-black text-xs uppercase tracking-[0.2em] hover:bg-indigo-500 transition mb-4 shadow-lg">Ch·∫•m ƒêi·ªÉm</button>
            <p id="r-msg" class="text-center text-[11px] font-bold uppercase tracking-widest h-6"></p>
        </div>
    </div>
</div>

<div id="music" class="tab-content">
    <div class="min-h-screen flex flex-col items-center pt-24 px-4 pb-24">
        <div class="flex flex-col md:flex-row gap-6 w-full max-w-6xl">
            <div class="glass-card p-4 w-full md:w-1/4 h-[500px] overflow-y-auto">
                <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-indigo-400 sticky top-0 bg-[#1a1a2e] pb-2 z-10">V-Pop Hits</h3>
                <div id="v-list" class="space-y-2"></div>
            </div>

            <div class="w-full md:w-2/4 flex flex-col">
                <div class="aspect-video bg-black rounded-2xl overflow-hidden border-2 border-white/10 shadow-2xl relative">
                    <div id="player" class="w-full h-full"></div> 
                    <video id="mp4-player" controls playsinline class="hidden w-full h-full object-cover"></video>
                </div>
                <div class="mt-4 text-center">
                    <h4 id="now-playing" class="text-xl font-bold text-white uppercase tracking-tight">Ch·ªçn b√†i h√°t ƒë·ªÉ ph√°t</h4>
                    <p class="text-xs text-gray-400 uppercase tracking-widest mt-1">Skyreign Music Player</p>
                </div>
            </div>

            <div class="glass-card p-4 w-full md:w-1/4 h-[500px] overflow-y-auto">
                <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-pink-400 sticky top-0 bg-[#1a1a2e] pb-2 z-10">Chinese Hits</h3>
                <div id="c-list" class="space-y-2"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU G·ªêC (RESTORED FROM V29) ---
    const vocabData = [
        { hz: "Êàë", py: "w«í", mn: "t√¥i" }, { hz: "‰Ω†", py: "n«ê", mn: "b·∫°n" }, { hz: "‰ªñ", py: "tƒÅ", mn: "anh ·∫•y" }, { hz: "Â•π", py: "tƒÅ", mn: "c√¥ ·∫•y" }, { hz: "Êàë‰ª¨", py: "w«ímen", mn: "ch√∫ng t√¥i" }, { hz: "Ë∞Å", py: "sh√©i", mn: "ai" },
        { hz: "Áà∏Áà∏", py: "b√†ba", mn: "b·ªë" }, { hz: "Â¶àÂ¶à", py: "mƒÅma", mn: "m·∫π" }, { hz: "ËÄÅÂ∏à", py: "l«éoshƒ´", mn: "th·∫ßy c√¥" }, { hz: "Â≠¶Áîü", py: "xu√©sheng", mn: "h·ªçc sinh" }, { hz: "ÂêåÂ≠¶", py: "t√≥ngxu√©", mn: "b·∫°n h·ªçc" }, { hz: "ÊúãÂèã", py: "p√©ngyou", mn: "b·∫°n b√®" }, { hz: "‰∫∫", py: "r√©n", mn: "ng∆∞·ªùi" },
        { hz: "Èõ∂", py: "l√≠ng", mn: "kh√¥ng" }, { hz: "‰∏Ä", py: "yƒ´", mn: "m·ªôt" }, { hz: "‰∫å", py: "√®r", mn: "hai" }, { hz: "‰∏â", py: "sƒÅn", mn: "ba" }, { hz: "Âõõ", py: "s√¨", mn: "b·ªën" }, { hz: "‰∫î", py: "w«î", mn: "nƒÉm" }, { hz: "ÂÖ≠", py: "li√π", mn: "s√°u" }, { hz: "‰∏É", py: "qƒ´", mn: "b·∫£y" }, { hz: "ÂÖ´", py: "bƒÅ", mn: "t√°m" }, { hz: "‰πù", py: "ji«î", mn: "ch√≠n" }, { hz: "ÂçÅ", py: "sh√≠", mn: "m∆∞·ªùi" },
        { hz: "Áé∞Âú®", py: "xi√†nz√†i", mn: "b√¢y gi·ªù" }, { hz: "ÁÇπ", py: "di«én", mn: "gi·ªù" }, { hz: "ÂàÜ", py: "fƒìn", mn: "ph√∫t" }, { hz: "‰ªäÂ§©", py: "jƒ´ntiƒÅn", mn: "h√¥m nay" }, { hz: "ÊòéÂ§©", py: "m√≠ngtiƒÅn", mn: "ng√†y mai" }, { hz: "Êò®Â§©", py: "zu√≥tiƒÅn", mn: "h√¥m qua" }, { hz: "Âπ¥", py: "ni√°n", mn: "nƒÉm" }, { hz: "Êúà", py: "yu√®", mn: "th√°ng" }, { hz: "Êó•", py: "r√¨", mn: "ng√†y" },
        { hz: "ÊòØ", py: "sh√¨", mn: "l√†" }, { hz: "Êúâ", py: "y«íu", mn: "c√≥" }, { hz: "Âú®", py: "z√†i", mn: "·ªü/ƒëang" }, { hz: "Ë¶Å", py: "y√†o", mn: "mu·ªën/c·∫ßn" }, { hz: "ÂñúÊ¨¢", py: "x«êhuan", mn: "th√≠ch" }, { hz: "Áà±", py: "√†i", mn: "y√™u" }, { hz: "ÂêÉ", py: "chƒ´", mn: "ƒÉn" }, { hz: "Âñù", py: "hƒì", mn: "u·ªëng" }, { hz: "Âéª", py: "q√π", mn: "ƒëi" }, { hz: "Êù•", py: "l√°i", mn: "ƒë·∫øn" }, { hz: "ÊÉ≥", py: "xi«éng", mn: "mu·ªën/nghƒ©" }, { hz: "Áúã", py: "k√†n", mn: "xem/nh√¨n" }, { hz: "Âê¨", py: "tƒ´ng", mn: "nghe" }, { hz: "ËØ¥", py: "shu≈ç", mn: "n√≥i" }, { hz: "ËØª", py: "d√∫", mn: "ƒë·ªçc" }, { hz: "ÂÜô", py: "xiƒõ", mn: "vi·∫øt" }, { hz: "ÂÅö", py: "zu√≤", mn: "l√†m" }, { hz: "‰π∞", py: "m«éi", mn: "mua" },
        { hz: "Â•Ω", py: "h«éo", mn: "t·ªët" }, { hz: "Â§ö", py: "du≈ç", mn: "nhi·ªÅu" }, { hz: "Â∞ë", py: "sh«éo", mn: "√≠t" }, { hz: "Â§ß", py: "d√†", mn: "to" }, { hz: "Â∞è", py: "xi«éo", mn: "nh·ªè" }, { hz: "ÂÜ∑", py: "lƒõng", mn: "l·∫°nh" }, { hz: "ÁÉ≠", py: "r√®", mn: "n√≥ng" }, { hz: "È´òÂÖ¥", py: "gƒÅox√¨ng", mn: "vui v·∫ª" }, { hz: "ÊºÇ‰∫Æ", py: "pi√†oliang", mn: "xinh ƒë·∫πp" }, { hz: "ÂØπ", py: "du√¨", mn: "ƒë√∫ng" }, { hz: "Èîô", py: "cu√≤", mn: "sai" }, { hz: "Âøô", py: "m√°ng", mn: "b·∫≠n" }, { hz: "Á¥Ø", py: "l√®i", mn: "m·ªát" },
        { hz: "Ê∞¥", py: "shu«ê", mn: "n∆∞·ªõc" }, { hz: "È•≠", py: "f√†n", mn: "c∆°m" }, { hz: "Ëèú", py: "c√†i", mn: "m√≥n ƒÉn" }, { hz: "Ëå∂", py: "ch√°", mn: "tr√†" }, { hz: "ËãπÊûú", py: "p√≠nggu«í", mn: "t√°o" }, { hz: "Èí±", py: "qi√°n", mn: "ti·ªÅn" }, { hz: "‰∏úË•ø", py: "d≈çngxi", mn: "ƒë·ªì ƒë·∫°c" }, { hz: "ÊùØÂ≠ê", py: "bƒìizi", mn: "c·ªëc" }, { hz: "Ë°£Êúç", py: "yƒ´fu", mn: "qu·∫ßn √°o" }, { hz: "‰π¶", py: "sh≈´", mn: "s√°ch" }, { hz: "Ê°åÂ≠ê", py: "zhu≈çzi", mn: "b√†n" }, { hz: "Ê§ÖÂ≠ê", py: "y«êzi", mn: "gh·∫ø" }, { hz: "ÁîµËÑë", py: "di√†nn«éo", mn: "m√°y t√≠nh" }, { hz: "ÁîµËßÜ", py: "di√†nsh√¨", mn: "tivi" },
        { hz: "‰∏ç", py: "b√π", mn: "kh√¥ng" }, { hz: "Ê≤°", py: "m√©i", mn: "ch∆∞a/kh√¥ng c√≥" }, { hz: "Âæà", py: "hƒõn", mn: "r·∫•t" }, { hz: "Â§™", py: "t√†i", mn: "qu√°" }, { hz: "ÈÉΩ", py: "d≈çu", mn: "ƒë·ªÅu" }, { hz: "Âíå", py: "h√©", mn: "v√†" }, { hz: "ÁöÑ", py: "de", mn: "c·ªßa" }, { hz: "Âêó", py: "ma", mn: "kh√¥ng (h·ªèi)" }, { hz: "Âë¢", py: "ne", mn: "th√¨ sao/nh·ªâ" }, { hz: "‰∫Ü", py: "le", mn: "r·ªìi" }, { hz: "‰ªÄ‰πà", py: "sh√©nme", mn: "c√°i g√¨" }, { hz: "Âì™ÂÑø", py: "n«ér", mn: "·ªü ƒë√¢u" }, { hz: "ÊÄé‰πà", py: "zƒõnme", mn: "th·∫ø n√†o" }, { hz: "Â§öÂ∞ë", py: "du≈çshao", mn: "bao nhi√™u" }, { hz: "Âá†", py: "j«ê", mn: "m·∫•y" }
    ];

    const readingData = [
        { id: 1, zh: "‰Ω†Â•ΩÔºÅÊàëÂè´ÂàòÈìÅËä±„ÄÇÊàëÊòØÂ≠¶Áîü„ÄÇÊàëÂÆ∂Êúâ‰∫îÂè£‰∫∫ÔºöÁà∏Áà∏„ÄÅÂ¶àÂ¶à„ÄÅÂì•Âì•„ÄÅÂ•≥ÂÑøÂíåÊàë„ÄÇÊàëÁà∏Áà∏ÊòØËÄÅÂ∏àÔºå‰ªñÂú®Â≠¶Ê†°Â∑•‰Ωú„ÄÇÊàëÂ¶àÂ¶à‰∏çÂ∑•‰ΩúÔºåÂ•πÂú®ÂÆ∂„ÄÇÊàëÊúâ‰∏Ä‰∏™Â•ΩÊúãÂèãÔºå‰ªñÊòØÊàëÁöÑÂêåÂ≠¶„ÄÇ", key: "xin ch√†o t√¥i t√™n l∆∞u thi·∫øt hoa t√¥i l√† h·ªçc sinh nh√† t√¥i c√≥ nƒÉm ng∆∞·ªùi b·ªë m·∫π anh trai con g√°i v√† t√¥i b·ªë t√¥i l√† gi√°o vi√™n √¥ng ·∫•y l√†m vi·ªác ·ªü tr∆∞·ªùng m·∫π t√¥i kh√¥ng ƒëi l√†m b√† ·∫•y ·ªü nh√† t√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n t·ªët c·∫≠u ·∫•y l√† b·∫°n h·ªçc c·ªßa t√¥i", vi_display: "Xin ch√†o! T√¥i t√™n L∆∞u Thi·∫øt Hoa. T√¥i l√† h·ªçc sinh. Nh√† t√¥i c√≥ 5 ng∆∞·ªùi: B·ªë, m·∫π, anh trai, con g√°i v√† t√¥i. B·ªë t√¥i l√† gi√°o vi√™n, √¥ng ·∫•y l√†m vi·ªác ·ªü tr∆∞·ªùng. M·∫π t√¥i kh√¥ng ƒëi l√†m, b√† ·∫•y ·ªü nh√†. T√¥i c√≥ m·ªôt ng∆∞·ªùi b·∫°n t·ªët, c·∫≠u ·∫•y l√† b·∫°n h·ªçc c·ªßa t√¥i." },
        { id: 2, zh: "‰ªäÂ§©ÊòüÊúüÂÖ≠„ÄÇÁé∞Âú®‰∏äÂçà‰πùÁÇπÔºåÊàëÂú®ÂÆ∂Áúã‰π¶„ÄÇ‰∏≠ÂçàÂçÅ‰∫åÁÇπÔºåÊàëÂéªÈ•≠Â∫óÂêÉÈ•≠„ÄÇÊàëÂñúÊ¨¢ÂêÉ‰∏≠ÂõΩËèúÔºåÂñùËå∂„ÄÇ‰∏ãÂçàÊàëË¶ÅÂéªÂïÜÂ∫ó‰π∞‰∏úË•ø„ÄÇÊàë‰π∞‰∫Ü‰∏Ä‰∏™ÊùØÂ≠êÂíåÂá†‰ª∂Ë°£Êúç„ÄÇ", key: "h√¥m nay l√† th·ª© b·∫£y b√¢y gi·ªù l√† ch√≠n gi·ªù s√°ng t√¥i ·ªü nh√† ƒë·ªçc s√°ch m∆∞·ªùi hai gi·ªù tr∆∞a t√¥i ƒëi nh√† h√†ng ƒÉn c∆°m t√¥i th√≠ch ƒÉn m√≥n trung qu·ªëc u·ªëng tr√† bu·ªïi chi·ªÅu t√¥i mu·ªën ƒëi c·ª≠a h√†ng mua ƒë·ªì t√¥i ƒë√£ mua m·ªôt c√°i c·ªëc v√† v√†i b·ªô qu·∫ßn √°o", vi_display: "H√¥m nay l√† th·ª© b·∫£y. B√¢y gi·ªù l√† 9 gi·ªù s√°ng, t√¥i ·ªü nh√† ƒë·ªçc s√°ch. 12 gi·ªù tr∆∞a, t√¥i ƒëi nh√† h√†ng ƒÉn c∆°m. T√¥i th√≠ch ƒÉn m√≥n Trung Qu·ªëc, u·ªëng tr√†. Bu·ªïi chi·ªÅu t√¥i mu·ªën ƒëi c·ª≠a h√†ng mua ƒë·ªì. T√¥i ƒë√£ mua m·ªôt c√°i c·ªëc v√† v√†i b·ªô qu·∫ßn √°o." },
        { id: 3, zh: "Ëøô‰∏™ÁîµËÑëÂ§öÂ∞ëÈí±ÔºüËøô‰∏™ÁîµËÑëÂÖ´ÂçÉÂùóÈí±„ÄÇÂ§™Ë¥µ‰∫ÜÔºÅÈÇ£‰∏™Ê°åÂ≠êÂíåÊ§ÖÂ≠êÂë¢ÔºüÈÇ£‰∏™Ê°åÂ≠ê‰∏çË¥µ„ÄÇ‰Ω†Ë¶Å‰π∞‰ªÄ‰πàÔºüÊàëË¶Å‰π∞‰∏Ä‰∏™Â∞èÊùØÂ≠ê„ÄÇÁªô‰Ω†Èí±„ÄÇË∞¢Ë∞¢„ÄÇ", key: "c√°i m√°y t√≠nh n√†y bao nhi√™u ti·ªÅn c√°i m√°y t√≠nh n√†y t√°m ngh√¨n t·ªá ƒë·∫Øt qu√° c√°i b√†n v√† gh·∫ø kia th√¨ sao c√°i b√†n ƒë√≥ kh√¥ng ƒë·∫Øt b·∫°n mu·ªën mua g√¨ t√¥i mu·ªën mua m·ªôt c√°i c·ªëc nh·ªè g·ª≠i b·∫°n ti·ªÅn c·∫£m ∆°n", vi_display: "C√°i m√°y t√≠nh n√†y bao nhi√™u ti·ªÅn? C√°i m√°y t√≠nh n√†y 8000 t·ªá. ƒê·∫Øt qu√°! C√°i b√†n v√† gh·∫ø kia th√¨ sao? C√°i b√†n ƒë√≥ kh√¥ng ƒë·∫Øt. B·∫°n mu·ªën mua g√¨? T√¥i mu·ªën mua m·ªôt c√°i c·ªëc nh·ªè. G·ª≠i b·∫°n ti·ªÅn. C·∫£m ∆°n." }
    ];

    const vPop = [
        {name:"H√¥n v√†o ƒë√¢y",type:"mp4",id:"https://files.catbox.moe/kos9gw.mp4",thumb:"https://img.youtube.com/vi/vs-hsW6I63I/mqdefault.jpg"},
        {name:"H√† N·ªôi",type:"mp4",id:"https://files.catbox.moe/1ygyge.mp4",thumb:"https://img.youtube.com/vi/OerAX-zKyvg/mqdefault.jpg"}
    ];
    const cPop = [
        {name:"Mang Ch·ªßng (M·ªõi)",type:"mp4",id:"https://files.catbox.moe/g2tdte.mp4",thumb:"https://img.youtube.com/vi/vgbrIy08e2w/mqdefault.jpg"},
        {name:"T√¢m L·∫∑ng Nh∆∞ N∆∞·ªõc",type:"mp4",id:"https://files.catbox.moe/p42gvs.mp4",thumb:"https://img.youtube.com/vi/ae9JqrRNWLk/mqdefault.jpg"},
        {name:"T·ª´ C·ª≠u M√¥n H·ªìi ·ª®c",type:"mp4",id:"https://files.catbox.moe/cqqpwx.mp4",thumb:"https://img.youtube.com/vi/IE7uUnMClsw/hqdefault.jpg"},
        {name:"Tam B√°i H·ªìng Tr·∫ßn L∆∞∆°ng",type:"mp4",id:"https://files.catbox.moe/f3yf9a.mp4",thumb:"https://img.youtube.com/vi/esWdcDSSrvE/hqdefault.jpg"}
    ];

    // --- LOGIC H·ªÜ TH·ªêNG ---
    let userCoins = parseInt(localStorage.getItem('skyCoins')) || 0;
    const coinDisplay = document.getElementById('coin-display');
    coinDisplay.innerText = userCoins;

    function updateCoins(amount) {
        userCoins += amount;
        localStorage.setItem('skyCoins', userCoins);
        coinDisplay.innerText = userCoins;
    }

    // TABS
    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('n-' + id).classList.add('active');
        
        if (id === 'vocab') { if(document.getElementById('v-question').innerText === "...") nextVocab(true); }
        if (id === 'reading') { if(document.getElementById('r-text').innerText === "ƒêang t·∫£i d·ªØ li·ªáu...") nextParagraph(); }
        if (id === 'memo') renderGrammarList();
        if (id === 'work') resetWorkSchedule();
    }

    // WORK SCHEDULE LOGIC
    const workDays = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "Ch·ªß Nh·∫≠t"];
    let workStep = 0;
    let scheduleData = [];

    function setVal(id, val) { document.getElementById(id).value = val; }
    
    function resetWorkSchedule() {
        workStep = 0;
        scheduleData = [];
        document.getElementById('work-wizard').classList.remove('hidden');
        document.getElementById('work-result').classList.add('hidden');
        setVal('w-date',''); setVal('w-pos',''); setVal('w-time','');
        updateWizardUI();
    }

    function updateWizardUI() {
        document.getElementById('w-day-title').innerText = workDays[workStep];
        document.getElementById('w-step-num').innerText = workStep + 1;
        if(workStep > 0 && scheduleData.length > 0) {
            const prevDate = scheduleData[workStep-1].date;
            const parts = prevDate.split('/');
            if(parts.length === 2) {
                let d = parseInt(parts[0]) + 1;
                let m = parseInt(parts[1]);
                if(d > 31) { d = 1; m++; }
                document.getElementById('w-date').value = `${d}/${m}`;
                document.getElementById('w-date-input-container').style.opacity = '0.5';
            }
        } else {
            document.getElementById('w-date-input-container').style.opacity = '1';
        }
    }

    function nextWorkStep() {
        const date = document.getElementById('w-date').value || "N/A";
        const pos = document.getElementById('w-pos').value || "N/A";
        const time = document.getElementById('w-time').value || "N/A";
        scheduleData.push({ day: workDays[workStep], date, pos, time });
        workStep++;
        if(workStep >= 7) {
            renderScheduleResult();
        } else {
            setVal('w-pos',''); setVal('w-time','');
            updateWizardUI();
        }
    }

    function renderScheduleResult() {
        document.getElementById('work-wizard').classList.add('hidden');
        document.getElementById('work-result').classList.remove('hidden');
        const tbody = document.getElementById('work-tbody');
        tbody.innerHTML = scheduleData.map(d => {
            let duration = 0;
            if(d.time.includes('-')) {
                const t = d.time.replace(/h/g, '.').split('-');
                if(t.length === 2) duration = parseFloat(t[1]) - parseFloat(t[0]);
            }
            return `<tr class="${d.pos === 'OFF' ? 'bg-red-500/20' : ''}">
                <td class="font-bold text-indigo-300">${d.day}</td>
                <td>${d.date}</td>
                <td class="uppercase font-bold">${d.pos}</td>
                <td>${d.time}</td>
                <td>${d.pos === 'OFF' ? '-' : (duration > 0 ? duration.toFixed(1) + 'h' : '?')}</td>
            </tr>`;
        }).join('');
    }

    // GRAMMAR TEST LOGIC
    const grammarRules = [
        { id: "g1", title: "S + ÊòØ + N", structure: "S + ÊòØ + N (L√†)", regex: /(.+)ÊòØ(.+)/ },
        { id: "g2", title: "S + ‰∏ç + ÊòØ + N", structure: "S + ‰∏ç + ÊòØ + N (Kh√¥ng l√†)", regex: /(.+)‰∏çÊòØ(.+)/ },
        { id: "g3", title: "S + ÊòØ + N + Âêó?", structure: "S + ÊòØ + N + Âêó? (H·ªèi)", regex: /(.+)ÊòØ(.+)Âêó[?Ôºü]?/ }
    ];
    let curTestRule = null;
    let curTestSentence = "";

    function setTestMode(mode) {
        document.getElementById('test-analyze').classList.add('hidden');
        document.getElementById('test-fill').classList.add('hidden');
        if(mode === 'analyze') {
            document.getElementById('test-analyze').classList.remove('hidden');
            startAnalyze();
        } else {
            document.getElementById('test-fill').classList.remove('hidden');
            nextFillTest();
        }
    }

    function startAnalyze() {
        curTestRule = grammarRules[Math.floor(Math.random() * 3)];
        const sub = ["Êàë","‰Ω†","‰ªñ","Áà∏Áà∏","ËÄÅÂ∏à"];
        const noun = ["Â≠¶Áîü","ÂåªÁîü","Â•Ω‰∫∫","Ë∂äÂçó‰∫∫"];
        const S = sub[Math.floor(Math.random() * sub.length)];
        const N = noun[Math.floor(Math.random() * noun.length)];
        
        if(curTestRule.id === "g1") curTestSentence = S + "ÊòØ" + N;
        if(curTestRule.id === "g2") curTestSentence = S + "‰∏çÊòØ" + N;
        if(curTestRule.id === "g3") curTestSentence = S + "ÊòØ" + N + "ÂêóÔºü";

        document.getElementById('ta-question').innerText = curTestSentence;
        document.getElementById('ta-status').innerText = "";
        document.getElementById('ta-step1').classList.remove('hidden');
        document.getElementById('ta-step2').classList.add('hidden');
        document.getElementById('ta-step3').classList.add('hidden');
        document.getElementById('ta-sub-input').value = "";
        document.getElementById('ta-noun-input').value = "";
        document.getElementById('ta-make-sentence').value = "";
        document.getElementById('ta-ai-feedback').innerText = "";

        document.getElementById('ta-options').innerHTML = grammarRules.map(r => 
            `<button onclick="checkRule('${r.id}')" class="w-full p-3 bg-white/10 hover:bg-indigo-600 border border-white/20 rounded text-left text-xs uppercase transition font-bold">${r.structure}</button>`
        ).join('');
    }

    function checkRule(id) {
        if(id === curTestRule.id) {
            updateCoins(1);
            document.getElementById('ta-status').innerText = "CH√çNH X√ÅC! (+1 Xu)";
            document.getElementById('ta-status').className = "text-center text-sm font-bold h-6 mb-4 text-green-400";
            setTimeout(() => {
                document.getElementById('ta-step1').classList.add('hidden');
                document.getElementById('ta-step2').classList.remove('hidden');
            }, 500);
        } else {
            updateCoins(-1);
            document.getElementById('ta-status').innerText = "SAI R·ªíI! (-1 Xu)";
            document.getElementById('ta-status').className = "text-center text-sm font-bold h-6 mb-4 text-red-400";
        }
    }

    function checkComponents() {
        const s = document.getElementById('ta-sub-input').value.trim();
        const n = document.getElementById('ta-noun-input').value.trim();
        if(curTestSentence.includes(s) && curTestSentence.includes(n) && s !== "" && n !== "") {
            updateCoins(1);
            alert("ƒê√∫ng th√†nh ph·∫ßn!");
            document.getElementById('ta-step2').classList.add('hidden');
            document.getElementById('ta-step3').classList.remove('hidden');
        } else {
            alert("Ch∆∞a ƒë√∫ng, h√£y nh√¨n k·ªπ c√¢u h·ªèi.");
        }
    }

    function checkAISentence() {
        const val = document.getElementById('ta-make-sentence').value;
        const fb = document.getElementById('ta-ai-feedback');
        if(val.match(curTestRule.regex) && /[\u4e00-\u9fa5]/.test(val)) {
            updateCoins(5);
            fb.innerText = "AI Ch·∫•p Thu·∫≠n: C√¢u T·ªët! (+5 Xu)";
            fb.style.color = "#4ade80";
            setTimeout(startAnalyze, 2000);
        } else {
            fb.innerText = "AI T·ª´ Ch·ªëi: Sai c·∫•u tr√∫c ho·∫∑c kh√¥ng ph·∫£i ti·∫øng Trung.";
            fb.style.color = "#f87171";
        }
    }

    // FILL TEST
    const dialogues = [
        {txt:"‰Ω†Â•ΩÔºÅÊàëÂè´L∆∞u Thi·∫øt Hoa. ÊàëÊòØÂ≠¶Áîü„ÄÇ", hide:"Â≠¶Áîü"},
        {txt:"‰Ω†ÂéªÂì™ÂÑøÔºüÊàëÂéªÂ≠¶Ê†°ÁúãËÄÅÂ∏à„ÄÇ", hide:"Â≠¶Ê†°"},
        {txt:"Ëøô‰∏™Â§öÂ∞ëÈí±ÔºüÂ§™Ë¥µ‰∫ÜÔºÅ", hide:"Èí±"},
        {txt:"‰Ω†ÊòØ‰∏≠ÂõΩ‰∫∫ÂêóÔºü‰∏çÊòØÔºåÊàëÊòØË∂äÂçó‰∫∫„ÄÇ", hide:"Ë∂äÂçó‰∫∫"}
    ];
    function nextFillTest() {
        const d = dialogues[Math.floor(Math.random() * dialogues.length)];
        document.getElementById('tf-dialogue').innerHTML = d.txt.replace(d.hide, `<span class="border-b-2 border-dashed border-white text-gray-500">???</span>`);
        document.getElementById('tf-msg').innerText = "";
        const opts = [d.hide, "Áà∏Áà∏", "‰ªÄ‰πà", "Âõ†‰∏∫"].sort(()=>Math.random()-0.5);
        document.getElementById('tf-options').innerHTML = opts.map(o => 
            `<button onclick="checkFill('${o}','${d.hide}')" class="px-4 py-2 bg-white/10 hover:bg-white/30 border border-white/20 rounded font-bold">${o}</button>`
        ).join('');
    }
    function checkFill(ans, corr) {
        if(ans === corr) {
            updateCoins(1);
            document.getElementById('tf-msg').innerText = "CH√çNH X√ÅC!";
            document.getElementById('tf-msg').style.color = "#4ade80";
            document.getElementById('tf-dialogue').innerText = document.getElementById('tf-dialogue').innerText.replace("???", corr);
            setTimeout(nextFillTest, 1500);
        } else {
            document.getElementById('tf-msg').innerText = "SAI R·ªíI";
            document.getElementById('tf-msg').style.color = "#f87171";
        }
    }

    // MEMO RENDER
    function renderGrammarList() {
        document.getElementById('grammar-list').innerHTML = grammarRules.map(r => {
            let ex = "";
            if(r.id === "g1") ex = "ÊàëÊòØÂ≠¶Áîü (T√¥i l√† h·ªçc sinh)";
            if(r.id === "g2") ex = "Êàë‰∏çÊòØËÄÅÂ∏à (T√¥i kh√¥ng ph·∫£i gi√°o vi√™n)";
            if(r.id === "g3") ex = "‰Ω†ÊòØ‰∏≠ÂõΩ‰∫∫ÂêóÔºü (B·∫°n l√† ng∆∞·ªùi TQ ph·∫£i kh√¥ng?)";
            return `
            <div class="bg-black/40 p-6 rounded-xl border border-white/10">
                <h3 class="text-xl font-bold text-indigo-400 mb-2">${r.title}</h3>
                <code class="block bg-black/30 p-2 rounded text-pink-400 mb-2 font-mono">${r.structure}</code>
                <p class="text-sm text-gray-300">V√≠ d·ª•: ${ex}</p>
            </div>`;
        }).join('');
        // Add extra rule 4
        document.getElementById('grammar-list').innerHTML += `
        <div class="bg-black/40 p-6 rounded-xl border border-white/10">
            <h3 class="text-xl font-bold text-indigo-400 mb-2">ƒê·∫°i t·ª´/Danh t·ª´ + ‰ª¨</h3>
            <code class="block bg-black/30 p-2 rounded text-pink-400 mb-2 font-mono">N + ‰ª¨ (S·ªë nhi·ªÅu)</code>
            <p class="text-sm text-gray-300">V√≠ d·ª•: Êàë‰ª¨ (Ch√∫ng t√¥i), ËÄÅÂ∏à‰ª¨ (C√°c th·∫ßy c√¥)</p>
        </div>`;
    }

    // VOCAB LOGIC
    let vMode = 0; let vIdx = 0; let remaining = [...Array(vocabData.length).keys()];
    function changeVocabMode() { vMode = (vMode + 1) % 3; const l = ["H√°n ‚ûî Vi·ªát", "Vi·ªát ‚ûî H√°n", "H√°n ‚ûî Pinyin"]; document.getElementById('v-mode-btn').innerText = "Mode: " + l[vMode]; nextVocab(false); }
    function nextVocab(rand) {
        if(remaining.length === 0) remaining = [...Array(vocabData.length).keys()];
        if(rand) vIdx = remaining[Math.floor(Math.random() * remaining.length)];
        const item = vocabData[vIdx];
        document.getElementById('v-question').innerText = vMode === 0 ? item.hz : (vMode === 1 ? item.mn.toUpperCase() : item.hz);
        document.getElementById('v-input').value = "";
        document.getElementById('v-msg').innerText = "";
        document.getElementById('v-hint').classList.add('hidden');
        document.getElementById('vocab-card').className = "glass-card p-10 w-full max-w-lg relative text-center";
    }
    function checkVocab() {
        const item = vocabData[vIdx];
        const val = document.getElementById('v-input').value.toLowerCase().trim();
        let ok = false; let ans = "";
        if(vMode === 0) { ok = val === item.mn.toLowerCase(); ans = item.mn; }
        else if(vMode === 1) { ok = val === item.hz; ans = item.hz; }
        else { ok = val === item.py || val === item.py.normalize("NFD").replace(/[\u0300-\u036f]/g, ""); ans = item.py; }

        if(ok) {
            updateCoins(1);
            document.getElementById('v-msg').innerText = "CH√çNH X√ÅC!";
            document.getElementById('v-msg').style.color = "#4ade80";
            document.getElementById('vocab-card').classList.add('glow-green');
            remaining = remaining.filter(i => i !== vIdx);
            setTimeout(() => nextVocab(true), 1000);
        } else {
            updateCoins(-1);
            document.getElementById('v-msg').innerText = "SAI R·ªíI";
            document.getElementById('v-msg').style.color = "#f87171";
            document.getElementById('v-hint').innerText = "ƒê√ÅP √ÅN: " + ans.toUpperCase();
            document.getElementById('v-hint').classList.remove('hidden');
            document.getElementById('vocab-card').classList.add('glow-red');
        }
    }

    // READING LOGIC
    let rIdx = 0;
    function nextParagraph() {
        rIdx = (rIdx + 1) % readingData.length;
        const d = readingData[rIdx];
        document.getElementById('r-text').innerText = d.zh;
        document.getElementById('r-input').value = "";
        document.getElementById('r-msg').innerText = "";
        document.getElementById('r-toggle-btn').innerText = "Xem ƒê√°p √Ån";
    }
    function toggleReadingRef() {
        const el = document.getElementById('r-text');
        const btn = document.getElementById('r-toggle-btn');
        if(btn.innerText === "Xem ƒê√°p √Ån") { el.innerText = readingData[rIdx].vi_display; btn.innerText = "Xem C√¢u H·ªèi"; }
        else { el.innerText = readingData[rIdx].zh; btn.innerText = "Xem ƒê√°p √Ån"; }
    }
    function checkReading() {
        const val = document.getElementById('r-input').value.toLowerCase();
        const key = readingData[rIdx].key;
        let count = 0;
        const words = val.split(" ");
        words.forEach(w => { if(key.includes(w) && w.length > 1) count++; });
        if(count > 5) { updateCoins(1); document.getElementById('r-msg').innerText = "T·ªêT L·∫ÆM! (+1 Xu)"; document.getElementById('r-msg').style.color = "#4ade80"; }
        else { document.getElementById('r-msg').innerText = "H√ÉY VI·∫æT CHI TI·∫æT H∆†N..."; document.getElementById('r-msg').style.color = "white"; }
    }

    // MUSIC LOGIC
    function renderMusic() {
        const tpl = (s) => `<div class="song-item" onclick="playMedia('${s.id}', '${s.type}', '${s.name}')"><img src="${s.thumb}"><div><h4 class="text-[10px] font-bold uppercase text-white">${s.name}</h4><span class="text-[9px] text-gray-400 bg-white/10 px-1 rounded">${s.type==='mp4'?'NO ADS':'YT'}</span></div></div>`;
        document.getElementById('v-list').innerHTML = vPop.map(tpl).join('');
        document.getElementById('c-list').innerHTML = cPop.map(tpl).join('');
    }
    var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; var firstScriptTag = document.getElementsByTagName('script')[0]; firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var player; function onYouTubeIframeAPIReady() { player = new YT.Player('player', { height: '100%', width: '100%', videoId: '' }); }
    function playMedia(src, type, name) {
        document.getElementById('now-playing').innerText = name;
        const yt = document.getElementById('player');
        const mp4 = document.getElementById('mp4-player');
        if(player && player.stopVideo) player.stopVideo();
        mp4.pause();
        if(type === 'mp4') { yt.style.display = 'none'; mp4.style.display = 'block'; mp4.src = src; mp4.play(); }
        else { mp4.style.display = 'none'; yt.style.display = 'block'; player.loadVideoById(src); }
    }

    // INIT
    window.onload = () => {
        switchTab('home');
        renderMusic();
        nextVocab(true);
        nextParagraph();
        renderGrammarList();
    };
</script>
</body>
</html>
